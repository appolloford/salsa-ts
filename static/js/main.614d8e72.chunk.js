(this["webpackJsonpsalsa-ts"]=this["webpackJsonpsalsa-ts"]||[]).push([[0],{124:function(e,t,n){},149:function(e,t,n){},150:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),c=n(12),s=n.n(c),o=(n(124),n(20)),r=n(22),l=n.n(r),u=n(37),d=n(151),j=n(34),b=n(36),x=n(160),f=n(74),h=n(48),O=n(18),p=n(31),v=Object(p.b)({name:"cursor",initialState:{position:[0,0],drag:"zoom"},reducers:{setPosition:function(e,t){e.position=t.payload},setDrag:function(e,t){e.drag=t.payload}}}),g=v.actions,m=g.setPosition,y=g.setDrag,w=v.reducer,P=Object(p.b)({name:"baseline",initialState:{dataPoints:[],fitValues:[]},reducers:{setDataPoints:function(e,t){e.dataPoints=t.payload},setFitValues:function(e,t){e.fitValues=t.payload}}}),S=P.actions,k=S.setDataPoints,F=S.setFitValues,A=P.reducer,C=n(27),z=n.n(C),G=n(70),q=n.n(G),R=n(71),T=n.n(R),V=n(6);T()(z.a),n(132)(z.a);var B=Object(a.memo)((function(e){var t,n,i,c=Object(O.b)(),s=Object(O.c)((function(e){return e.cursor.drag})),r="baseline"===s||"gaussian"===s,l=Object(O.c)((function(e){return e.baseline.fitValues})),u=l.length>0,d=Object(a.useRef)(null),j=null===(t=d.current)||void 0===t?void 0:t.chart,b=e.gaussianGuess,x=e.setGaussianGuess,f=e.gaussianData,p=e.getGaussianFit,v=e.fileName,g=e.dataSource,y=e.unit,w=e.setUnit,P=Object(a.useState)([]),S=Object(o.a)(P,2),F=S[0],A=S[1],C=Object(a.useState)(!1),G=Object(o.a)(C,2),R=G[0],T=G[1];"baseline"===s?n=function(e){console.log(e),console.log(j),console.log("chart option",null===j||void 0===j?void 0:j.options),(null===j||void 0===j?void 0:j.series)&&j.series.forEach((function(t){!0===t.options.allowPointSelect&&(null===t||void 0===t||t.points.forEach((function(t){t.x>=e.xAxis[0].min&&t.x<=e.xAxis[0].max&&t.y>=e.yAxis[0].min&&t.y<=e.yAxis[0].max&&t.select(!0,!0)})))}));var t=(null===j||void 0===j?void 0:j.getSelectedPoints().map((function(e){return[e.x||0,e.y||0]})))||[];return c(k(t)),!1}:"gaussian"===s&&(n=function(e){var t=e.xAxis[0].min,n=e.xAxis[0].max,a=e.yAxis[0].min,i=e.yAxis[0].max,c=(null===j||void 0===j?void 0:j.xAxis[0].toPixels(t,!1))||0,s=(null===j||void 0===j?void 0:j.xAxis[0].toPixels(n,!1))||0,o=(null===j||void 0===j?void 0:j.yAxis[0].toPixels(a,!1))||0,r=(null===j||void 0===j?void 0:j.yAxis[0].toPixels(i,!1))||0,l=s-c,u=o-r;console.log("rect params",c,r,l,u);var d=null===j||void 0===j?void 0:j.renderer.rect(c,r,l,u,2).attr({"stroke-width":2,stroke:"red",fill:"black","fill-opacity":.1,zIndex:3}).add();return x([].concat(Object(h.a)(b),[[t,n,a,i]])),A([].concat(Object(h.a)(F),[d])),!1}),i="freq-k"===y?"kHz":"freq-m"===y?"MHz":"freq-g"===y?"GHz":"chan"===y?"Channel":"vel"===y?"Velocity (km/s)":"Hz";var B={chart:{zoomType:"x"},tooltip:{enabled:!0},plotOptions:{series:{enableMouseTracking:!0,tooltip:{followPointer:!1}}}},H=[];if(g){var L=g.axisdata(1,y).toJs(),D=g.rawdata.toJs()[0][0],I=g.header.toJs(),J=[].slice.call(L);H=J.map((function(e,t){return[e,D[t]]}));var N=J.map((function(e,t){return[e,0]}));if(!0===u&&N.forEach((function(e,t){e[1]=l[t]})),!0===R){var U=H.map((function(e,t){return[e[0],e[1]-N[t][1]]}));B.series=[{name:"Observation - Baseline",type:"scatter",data:U,findNearestPointBy:"xy"}]}else B.series=[{name:"Observation",type:"scatter",lineWidth:2,data:H,allowPointSelect:r,findNearestPointBy:"xy"}],!0===u&&B.series.push({name:"Baseline fitting",type:"line",data:N,allowPointSelect:!1,colorIndex:3}),console.log("series",B.series);if(f){var M=J.map((function(e,t){return[e,0]}));M.forEach((function(e,t){e[1]=f[t]})),B.series.push({name:"Gaussian",type:"line",data:M,findNearestPointBy:"xy",colorIndex:5})}var Y="".concat(I.get("CTYPE2"),": ").concat(I.get("CRVAL2").toFixed(6),", ").concat(I.get("CTYPE3"),": ").concat(I.get("CRVAL3").toFixed(6));B.title={text:v},B.subtitle={text:Y};var W={title:{text:i}},X={title:{text:I.get("BUNIT")}};B.xAxis=W,B.yAxis=X}!0===r&&B.chart?(B.chart.zoomType="xy",B.chart.renderTo=null===j||void 0===j?void 0:j.container,B.chart.events={selection:n,click:function(){var e=null===j||void 0===j?void 0:j.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)})),c(k([]))}}):B.chart&&(B.chart.zoomType="x",B.chart.events={selection:void 0,click:void 0,render:void 0}),console.log("options",B);return Object(V.jsxs)("div",{children:[Object(V.jsx)(q.a,{highcharts:z.a,options:B,ref:d,containerProps:{onMouseMove:function(e){var t=function(e){var t=0,n=0;if(j){var a=j.pointer.normalize(e),i=a.chartX-j.plotLeft,c=a.chartY-j.plotTop;i>=0&&c>=0&&i<=j.chartWidth&&c<=j.chartHeight&&(t=j.xAxis[0].toValue(i,!0),n=j.yAxis[0].toValue(c,!0))}return{xPos:t,yPos:n}}(e),n=t.xPos,a=t.yPos;c(m([n,a]))}}}),Object(V.jsx)(E,{unit:y,setUnit:w,dataSource:g,showSubtraction:R,setShowSubtraction:T,getGaussianFit:p})]})})),E=function(e){var t=Object(O.b)(),n=Object(O.c)((function(e){return e.cursor.drag})),i=Object(O.c)((function(e){return e.baseline.dataPoints})),c=Object(O.c)((function(e){return e.baseline.fitValues})).length>0,s=i.map((function(e){return e[0]})),r=i.map((function(e){return e[1]})),l=e.dataSource,u=e.showSubtraction,j=e.setShowSubtraction,b=e.getGaussianFit,x=e.unit,f=e.setUnit,h=Object(a.useState)(0),p=Object(o.a)(h,2),v=p[0],g=p[1],m=Object(a.useState)(!1),w=Object(o.a)(m,2),P=w[0],S=w[1],A=function(e,n){var a=null===l||void 0===l?void 0:l.fit_baseline(e,n,x).toJs(),i=[].slice.call(a);t(F(i))};return Object(V.jsxs)("div",{style:{display:"flex"},children:[Object(V.jsxs)(d.b,{children:[Object(V.jsx)(d.a,{icon:"zoom-in",small:!0,active:"zoom"===n,onClick:function(){t(y("zoom"))}}),Object(V.jsx)(d.a,{icon:"widget-button",small:!0,active:"baseline"===n,disabled:u,onClick:function(){t(y("baseline"))}}),Object(V.jsx)(d.a,{icon:"widget",small:!0,active:"gaussian"===n,disabled:!c||!u,onClick:function(){t(y("gaussian"))}})]}),Object(V.jsx)(d.e,{}),Object(V.jsx)(d.a,{icon:"bring-data",small:!0,active:u,onClick:function(){j(!u),t(y("zoom"))}}),Object(V.jsx)(d.a,{icon:"regression-chart",small:!0,disabled:!i.length,onClick:function(){A(s,r)}}),Object(V.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){t(k([])),A([],[])}}),Object(V.jsx)(d.e,{}),Object(V.jsx)(d.a,{icon:"step-chart",small:!0,active:P,onClick:function(){b(P?0:v),S(!P)}}),Object(V.jsxs)(d.q,{children:[Object(V.jsx)(d.a,{text:v,small:!0}),Object(V.jsx)(d.p,{style:{width:30},value:v,min:1,onValueChange:function(e){g(e),P&&b(e)}})]}),Object(V.jsx)(d.f,{style:{marginLeft:"auto",height:10},label:"x-axis unit:",inline:!0,children:Object(V.jsxs)(d.g,{value:x,minimal:!0,onChange:function(e){f(e.target.value)},children:[Object(V.jsx)("option",{value:"freq",children:"Frequency (Hz)"}),Object(V.jsx)("option",{value:"freq-k",children:"Frequency (kHz)"}),Object(V.jsx)("option",{value:"freq-m",children:"Frequency (MHz)"}),Object(V.jsx)("option",{value:"freq-g",children:"Frequency (GHz)"}),Object(V.jsx)("option",{value:"chan",children:"Channel"}),Object(V.jsx)("option",{value:"vel",children:"Velocity (km/s)"})]})})]})},H=B,L=n.p+"static/media/salsasource.09b19ac8.py",D=(n(149),function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"});case 2:return t=e.sent,e.next=5,t.loadPackage(["astropy","scipy"]);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),I=function(){var e=Object(u.a)(l.a.mark((function e(t,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.runPythonAsync(n);case 2:return a=t.globals.get("salsa"),console.log("globals",a),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var J=function(e){var t=Object(O.c)((function(e){return e.cursor.position}));return Object(V.jsx)("div",{style:{textAlign:"left"},children:Object(V.jsxs)(d.k,{children:["Position: (",t[0].toFixed(6),", ",t[1].toFixed(6),")"]})})},N=function(e){var t=Object(O.c)((function(e){return e.baseline.dataPoints}));return Object(V.jsx)(d.c,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(V.jsxs)(x.a,{numRows:t.length,enableGhostCells:!0,children:[Object(V.jsx)(f.a,{name:"X coordinate",cellRenderer:function(e){return Object(V.jsx)(b.a,{children:"".concat(t[e]?t[e][0].toFixed(6):0)})}}),Object(V.jsx)(f.a,{name:"Y coordinate",cellRenderer:function(e){return Object(V.jsx)(b.a,{children:"".concat(t[e]?t[e][1].toFixed(6):0)})}})]})})},U=function(e){var t=e.gaussianGuess;return Object(V.jsx)(d.c,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(V.jsxs)(x.a,{numRows:t.length,enableGhostCells:!0,columnWidths:[300,200],children:[Object(V.jsx)(f.a,{name:"X range",cellRenderer:function(e){return Object(V.jsxs)(b.a,{children:["(","".concat(t[e]?t[e][0].toFixed(6):0),",","".concat(t[e]?t[e][1].toFixed(6):0),")"]})}}),Object(V.jsx)(f.a,{name:"Y range",cellRenderer:function(e){return Object(V.jsxs)(b.a,{children:["(","".concat(t[e]?t[e][2].toFixed(6):0),",","".concat(t[e]?t[e][3].toFixed(6):0),")"]})}})]})})},M=function(){Object(O.b)();var e=Object(a.useRef)(null),t=Object(a.useState)(!1),n=Object(o.a)(t,2),i=n[0],c=n[1],s=Object(a.useState)(""),r=Object(o.a)(s,2),b=r[0],x=r[1],f=Object(a.useState)("freq"),h=Object(o.a)(f,2),p=h[0],v=h[1],g=Object(a.useState)([]),m=Object(o.a)(g,2),y=m[0],w=m[1],P=Object(a.useState)([]),S=Object(o.a)(P,2),k=S[0],F=S[1];Object(a.useEffect)((function(){function t(){return(t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=7;break}return t.next=3,D();case 3:e.current=t.sent,c(!0),t.next=8;break;case 7:console.log("no duplicate reload to avoid pyodide error");case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}));var A=Object(a.useState)(),C=Object(o.a)(A,2),z=C[0],G=C[1],q=function(){var t=Object(u.a)(l.a.mark((function t(n){var a,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(L);case 2:return t.next=4,t.sent.text();case 4:return a=t.sent,t.next=7,I(e.current,a);case 7:i=t.sent,x(n.name),G(i);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(V.jsxs)("div",{className:"App",children:[Object(V.jsx)(d.l,{children:Object(V.jsxs)(d.n,{align:j.a.LEFT,children:[Object(V.jsx)(d.o,{children:"SalsaTS"}),Object(V.jsx)(d.m,{}),Object(V.jsx)(d.a,{disabled:!i,children:Object(V.jsxs)("label",{htmlFor:"input",children:[Object(V.jsx)("input",{type:"file",id:"input",hidden:!0,onChange:function(e){!function(e){if(e){console.log("processing file:",e);var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){window.jsarray=new Float32Array(t.result),q(e)},t.readAsArrayBuffer(e)}}(e.target.files[0])}}),Object(V.jsx)(d.i,{icon:"document"})," Upload"]})})]})}),Object(V.jsx)(H,{fileName:b,dataSource:z,unit:p,setUnit:v,gaussianGuess:y,setGaussianGuess:w,gaussianData:k,getGaussianFit:function(e){var t=null===z||void 0===z?void 0:z.fit_gaussian(p,e,y).toJs();F(t)}}),Object(V.jsx)("div",{style:{display:"flex"},children:Object(V.jsx)("div",{style:{flex:1},children:Object(V.jsxs)(d.s,{children:[Object(V.jsx)(d.r,{id:"cursorpanel",title:"Cursor Information",panel:Object(V.jsx)(J,{})}),Object(V.jsx)(d.r,{id:"baselinepoints",title:"Selected Baseline Points",panel:Object(V.jsx)(N,{})}),Object(V.jsx)(d.r,{id:"gaussianranges",title:"Selected Gaussian Ranges",panel:Object(V.jsx)(U,{gaussianGuess:y})})]})})})]})},Y=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,161)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,c=t.getLCP,s=t.getTTFB;n(e),a(e),i(e),c(e),s(e)}))},W=Object(p.a)({reducer:{cursor:w,baseline:A}});s.a.render(Object(V.jsx)(i.a.StrictMode,{children:Object(V.jsx)(O.a,{store:W,children:Object(V.jsx)(M,{})})}),document.getElementById("root")),Y()}},[[150,1,2]]]);
//# sourceMappingURL=main.614d8e72.chunk.js.map