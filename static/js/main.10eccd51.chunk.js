(this["webpackJsonpsalsa-ts"]=this["webpackJsonpsalsa-ts"]||[]).push([[0],{133:function(e,n,t){},159:function(e,n,t){},160:function(e,n,t){"use strict";t.r(n);var a=t(0),i=t.n(a),s=t(14),c=t.n(s),o=(t(133),t(21)),r=t(24),l=t.n(r),u=t(41),b=t(161),d=t(36),j=t(42),f=t(11),h=t(25),O=Object(h.b)({name:"cursor",initialState:{position:[0,0],drag:"zoom"},reducers:{setPosition:function(e,n){e.position=n.payload},setDrag:function(e,n){e.drag=n.payload}}}),x=O.actions,p=x.setPosition,m=x.setDrag,g=O.reducer,v=Object(h.b)({name:"baseline",initialState:{baselinePoints:[],baselineFitOrder:2,baselineFitValues:[],showSubtraction:!1,showBaselineTable:!1},reducers:{setBaselinePoints:function(e,n){e.baselinePoints=n.payload},setBaselineFit:function(e,n){e.baselineFitValues=n.payload},setBaselineFitOrder:function(e,n){e.baselineFitOrder=n.payload},setShowSubtraction:function(e,n){e.showSubtraction=n.payload},setShowBaselineTable:function(e,n){e.showBaselineTable=n.payload}}}),y=v.actions,w=y.setBaselinePoints,T=y.setBaselineFit,S=y.setBaselineFitOrder,P=y.setShowSubtraction,F=y.setShowBaselineTable,k=v.reducer,C=Object(h.b)({name:"gaussian",initialState:{order:0,isFitting:!1,guess:[],gaussianParams:[],gaussianSingleFit:[],gaussianStack:[],showGaussianSingles:!1,showGaussianTable:!1},reducers:{setOrder:function(e,n){e.order=n.payload},setIsFitting:function(e,n){e.isFitting=n.payload},setGaussianGuess:function(e,n){e.guess=n.payload},setGaussianParams:function(e,n){e.gaussianParams=n.payload},setGaussianSingleFit:function(e,n){e.gaussianSingleFit=n.payload},setGaussianStack:function(e,n){e.gaussianStack=n.payload},setShowGaussianSingles:function(e,n){e.showGaussianSingles=n.payload},setShowGaussianTable:function(e,n){e.showGaussianTable=n.payload}}}),G=C.actions,A=G.setOrder,B=G.setIsFitting,E=G.setGaussianGuess,L=G.setGaussianParams,z=G.setGaussianSingleFit,R=G.setGaussianStack,q=G.setShowGaussianSingles,N=G.setShowGaussianTable,_=C.reducer,I=t(22),H=t.n(I),V=t(75),J=t.n(V),U=t(76),D=t.n(U),M=t(77),Y=t.n(M),W=t(40),X=t(175),K=t(81),Q=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return(e=0).toFixed(n);var t=e.toExponential().split("e").map((function(e){return Number(e)})),a=Object(o.a)(t,2),i=a[0],s=a[1];return 0===s?"".concat(i.toFixed(n)):"".concat(i.toFixed(n),"x10^").concat(s)},Z=t(15),$=t(2),ee=t(82),ne=t(53),te=t(6),ae=function(e){var n=Object(f.b)(),t=Object(f.c)((function(e){return e.cursor.position})),a=Object(f.c)((function(e){return e.cursor.drag})),i=Object(f.c)((function(e){return e.baseline.baselinePoints})),s=Object(f.c)((function(e){return e.baseline.baselineFitValues})),c=Object(f.c)((function(e){return e.baseline.baselineFitOrder})),o=Object(f.c)((function(e){return e.baseline.showSubtraction})),r=Object(f.c)((function(e){return e.baseline.showBaselineTable})),l=s.length>0,u=Object(f.c)((function(e){return e.gaussian.order})),d=Object(f.c)((function(e){return e.gaussian.isFitting})),j=Object(f.c)((function(e){return e.gaussian.guess})),h=Object(f.c)((function(e){return e.gaussian.showGaussianSingles})),O=Object(f.c)((function(e){return e.gaussian.showGaussianTable})),x=e.fitGaussian,p=e.fitBaseline,g=e.unit,v=e.setUnit,y=e.unSelectAllPoints;return Object(te.jsxs)("div",{style:{display:"flex"},children:[Object(te.jsxs)(b.c,{children:[Object(te.jsx)(ee.a,{content:"Cursor action: drag to zoom",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"zoom-in",small:!0,active:"zoom"===a,onClick:function(){n(m("zoom"))}})}),Object(te.jsx)(ee.a,{content:"Cursor action: select baseline points",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"widget-button",small:!0,active:"baseline"===a,disabled:o,onClick:function(){n(m("baseline"))}})}),Object(te.jsx)(ee.a,{content:"Cursor action: select gaussian peak ranges",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"widget",small:!0,active:"gaussian"===a,disabled:!l||!o,onClick:function(){n(m("gaussian"))}})})]}),Object(te.jsx)(b.g,{}),Object(te.jsx)(ne.a,{content:Object(te.jsx)(b.r,{style:{width:30},value:c,min:1,onValueChange:function(e){n(S(e)),p(e,i)}}),children:Object(te.jsx)(ee.a,{content:"Number of Gaussian peaks",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{text:c,small:!0})})}),Object(te.jsx)(ee.a,{content:"Subtraction baseline",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"bring-data",small:!0,active:o,onClick:function(){n(P(!o)),n(m("zoom"))}})}),Object(te.jsx)(ee.a,{content:"Show baseline table",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"th",small:!0,onClick:function(){n(F(!r))}})}),Object(te.jsx)(ee.a,{content:"Remove all baseline data",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"delete",small:!0,onClick:function(){y(),n(B(!1)),n(E([])),n(R([]))}})}),Object(te.jsx)(b.g,{}),Object(te.jsx)(ee.a,{className:$.a.TOOLTIP_INDICATOR,content:"Fit Gaussian",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"timeline-bar-chart",small:!0,active:d,disabled:!i.length||!o,onClick:function(){d?n(R([])):x(s,u,j),n(B(!d))}})}),Object(te.jsx)(ee.a,{className:$.a.TOOLTIP_INDICATOR,content:"Show Gaussian by each",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"stacked-chart",small:!0,active:h,disabled:!i.length||!o,onClick:function(){n(q(!h))}})}),Object(te.jsx)(ne.a,{content:Object(te.jsx)(b.r,{style:{width:30},value:u,min:0,onValueChange:function(e){n(A(e)),d&&x(s,e,j)}}),children:Object(te.jsx)(ee.a,{content:"Number of Gaussian peaks",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{text:u,small:!0})})}),Object(te.jsx)(ee.a,{content:"Show gaussian table",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"th",small:!0,onClick:function(){n(N(!O))}})}),Object(te.jsx)(ee.a,{content:"Remove all gaussian data",position:Z.a.TOP_LEFT,minimal:!0,children:Object(te.jsx)(b.a,{icon:"delete",small:!0,onClick:function(){n(B(!1)),n(E([])),n(R([]))}})}),Object(te.jsxs)(b.b,{style:{marginLeft:"auto",height:10},small:!0,minimal:!0,disabled:!0,children:["(x, y) = (",Q(t[0]),", ",Q(t[1]),")"]}),Object(te.jsx)(b.i,{style:{marginLeft:"auto",height:10},label:"x-axis unit:",inline:!0,children:Object(te.jsxs)(b.j,{value:g,minimal:!0,onChange:function(e){v(e.target.value)},children:[Object(te.jsx)("option",{value:"freq",children:"Frequency (Hz)"}),Object(te.jsx)("option",{value:"freq-k",children:"Frequency (kHz)"}),Object(te.jsx)("option",{value:"freq-m",children:"Frequency (MHz)"}),Object(te.jsx)("option",{value:"freq-g",children:"Frequency (GHz)"}),Object(te.jsx)("option",{value:"chan",children:"Channel"}),Object(te.jsx)("option",{value:"vel",children:"Velocity (km/s)"})]})})]})};D()(H.a),Y()(H.a),t(157)(H.a),t(158)(H.a);var ie=Object(a.memo)((function(e){var n,t,i=Object(f.b)(),s=Object(f.c)((function(e){return e.cursor.drag})),c=Object(f.c)((function(e){return e.baseline.baselineFitValues})),r=Object(f.c)((function(e){return e.baseline.baselineFitOrder})),l=Object(f.c)((function(e){return e.baseline.showSubtraction})),u=Object(f.c)((function(e){return e.baseline.showBaselineTable})),d=c.length>0,h=Object(f.c)((function(e){return e.gaussian.order})),O=Object(f.c)((function(e){return e.gaussian.isFitting})),x=Object(f.c)((function(e){return e.gaussian.guess})),m=Object(f.c)((function(e){return e.gaussian.gaussianSingleFit})),g=Object(f.c)((function(e){return e.gaussian.gaussianStack})),v=Object(f.c)((function(e){return e.gaussian.showGaussianSingles})),y=Object(f.c)((function(e){return e.gaussian.showGaussianTable})),S=250/(Number(u)+Number(y)),P=Object(a.useRef)(null),F=null===(n=P.current)||void 0===n?void 0:n.chart,k=e.fileName,C=e.dataSource,G=e.unit,A=e.setUnit,B=function(e,n){var t=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),s=null===C||void 0===C?void 0:C.fit_baseline(t,a,G,e).toJs(),c=[].slice.call(s);i(T(c))},q=function(e,n,t){var a=t.map((function(e){var n=Object(o.a)(e,4),t=n[0],a=n[1],i=n[2],s=n[3],c=null===C||void 0===C?void 0:C.convertfreq(t,G),r=null===C||void 0===C?void 0:C.convertfreq(a,G);return[c<=r?c:r,c<=r?r:c,i,s]})),s=null===C||void 0===C?void 0:C.fit_gaussian(G,e,n,a).toJs(),c=[].slice.call(s[0]),r=s[1].map((function(e){return[].slice.call(e)})),l=s[2].map((function(e){return[].slice.call(e)}));i(R(c)),i(L(l)),i(z(r))},N=function(){var e=null===F||void 0===F?void 0:F.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)})),i(w([])),B(r,[])};t="freq-k"===G?"kHz":"freq-m"===G?"MHz":"freq-g"===G?"GHz":"chan"===G?"Channel":"vel"===G?"Velocity (km/s)":"Hz";var _={chart:{zoomType:"x"},tooltip:{enabled:!0},plotOptions:{series:{enableMouseTracking:!0,tooltip:{followPointer:!1},events:{click:function(e){i(E(x.filter((function(n,t){return t!==e.point.series.index-(3-Number(l))}))))}}}}},I=[];if(C){var V=C.axisdata(1,G).toJs(),U=C.rawdata.toJs()[0][0],D=C.header.toJs(),M=[].slice.call(V);I=M.map((function(e,n){return[e,U[n]]}));var Y=M.map((function(e,n){return[e,0]}));if(!0===d&&Y.forEach((function(e,n){e[1]=c[n]})),!0===l){var W=I.map((function(e,n){return[e[0],e[1]-Y[n][1]]}));_.series=[{name:"Observation - Baseline",type:"scatter",data:W,findNearestPointBy:"xy"}]}else _.series=[{name:"Observation",type:"scatter",lineWidth:2,data:I,allowPointSelect:"zoom"!==s,findNearestPointBy:"xy"}],!0===d&&_.series.push({name:"Baseline fitting",type:"line",data:Y,allowPointSelect:!1,colorIndex:1}),console.log("series",_.series);if(x){var X=x.map((function(e,n){var t=Object(o.a)(e,4),a=t[0],i=t[1],s=t[2],c=t[3],r=null===C||void 0===C?void 0:C.convertfreq(a,G),l=null===C||void 0===C?void 0:C.convertfreq(i,G);return{name:"Peak ".concat(n+1),type:"polygon",data:[[r,s],[l,s],[l,c],[r,c]],colorIndex:2,opacity:.5}}));X&&(_.series=[].concat(Object(j.a)(_.series),Object(j.a)(X)))}if(g){var K=M.map((function(e,n){return[e,g[n]]}));_.series.push({name:"Gaussian",type:"line",data:K,findNearestPointBy:"xy",colorIndex:3})}if(m&&v)m.map((function(e){return e.map((function(e,n){return[M[n],e]}))})).forEach((function(e,n){var t;null===(t=_.series)||void 0===t||t.push({name:"Gaussian Component ".concat(n),type:"area",data:e,colorIndex:4+n})}));var Z="".concat(D.get("CTYPE2"),": ").concat(Q(D.get("CRVAL2")),", ").concat(D.get("CTYPE3"),": ").concat(Q(D.get("CRVAL3")));_.title={text:k},_.subtitle={text:Z};var $={title:{text:t}},ee={title:{text:D.get("BUNIT")}};_.xAxis=$,_.yAxis=ee}"baseline"===s&&_.chart?(_.chart.zoomType="xy",_.chart.renderTo=null===F||void 0===F?void 0:F.container,_.chart.events={selection:function(e){(null===F||void 0===F?void 0:F.series)&&F.series.forEach((function(n){!0===n.options.allowPointSelect&&(null===n||void 0===n||n.points.forEach((function(n){n.x>=e.xAxis[0].min&&n.x<=e.xAxis[0].max&&n.y>=e.yAxis[0].min&&n.y<=e.yAxis[0].max&&n.select(!0,!0)})))}));var n=(null===F||void 0===F?void 0:F.getSelectedPoints().map((function(e){return[e.x||0,e.y||0]})))||[];return i(w(n)),B(r,n),!1},click:N}):"gaussian"===s&&_.chart?(_.chart.zoomType="xy",_.chart.renderTo=null===F||void 0===F?void 0:F.container,_.chart.events={selection:function(e){var n=[null===C||void 0===C?void 0:C.convert2freq(e.xAxis[0].min,G),null===C||void 0===C?void 0:C.convert2freq(e.xAxis[0].max,G),e.yAxis[0].min,e.yAxis[0].max];return i(E([].concat(Object(j.a)(x),[n]))),O&&q(c,h,[].concat(Object(j.a)(x),[n])),!1}}):_.chart&&(_.chart.zoomType="x",_.chart.events={selection:void 0,click:void 0,render:void 0}),console.log("options",_);return Object(te.jsxs)("div",{children:[Object(te.jsx)(J.a,{highcharts:H.a,options:_,ref:P,containerProps:{onMouseMove:function(e){var n=function(e){var n=0,t=0;if(F){var a=F.pointer.normalize(e),i=a.chartX-F.plotLeft,s=a.chartY-F.plotTop;i>=0&&s>=0&&i<=F.chartWidth&&s<=F.chartHeight&&(n=F.xAxis[0].toValue(i,!0),t=F.yAxis[0].toValue(s,!0))}return{xPos:n,yPos:t}}(e),t=n.xPos,a=n.yPos;i(p([t,a]))}}}),Object(te.jsx)(ae,{unit:G,setUnit:A,dataSource:C,fitBaseline:B,fitGaussian:q,unSelectAllPoints:N}),Object(te.jsx)(b.g,{}),Object(te.jsx)(b.e,{isOpen:u,children:Object(te.jsx)(se,{height:S})}),Object(te.jsx)(b.e,{isOpen:y,children:Object(te.jsx)(ce,{height:S})})]})})),se=function(e){var n=Object(f.c)((function(e){return e.baseline.baselinePoints}));return Object(te.jsxs)(b.d,{style:{display:"block",overflow:"auto",height:e.height},children:["Selected Points:",Object(te.jsxs)(X.a,{numRows:n.length,enableGhostCells:!0,columnWidths:[400,400],children:[Object(te.jsx)(K.a,{name:"X coordinate",cellRenderer:function(e){return Object(te.jsx)(W.a,{children:"".concat(n[e]?Q(n[e][0]):0)})}}),Object(te.jsx)(K.a,{name:"Y coordinate",cellRenderer:function(e){return Object(te.jsx)(W.a,{children:"".concat(n[e]?Q(n[e][1]):0)})}})]})]})},ce=function(e){var n=Object(f.c)((function(e){return e.gaussian.order})),t=Object(f.c)((function(e){return e.gaussian.guess})),a=Object(f.c)((function(e){return e.gaussian.gaussianParams})),i=n>t.length?n:t.length;return Object(te.jsxs)(b.d,{style:{display:"block",overflow:"auto",height:e.height},children:["Constraints:",Object(te.jsxs)(X.a,{numRows:i,enableGhostCells:!0,columnWidths:[400,400,150,150,150],children:[Object(te.jsx)(K.a,{name:"X range",cellRenderer:function(e){return Object(te.jsxs)(W.a,{children:["(","".concat(t[e]?Q(t[e][0]):0),","," ".concat(t[e]?Q(t[e][1]):0),")"]})}}),Object(te.jsx)(K.a,{name:"Y range",cellRenderer:function(e){return Object(te.jsxs)(W.a,{children:["(","".concat(t[e]?Q(t[e][2]):0),","," ".concat(t[e]?Q(t[e][3]):0),")"]})}}),Object(te.jsx)(K.a,{name:"mean",cellRenderer:function(e){return Object(te.jsx)(W.a,{children:"".concat(a[e]?Q(a[e][0]):0)})}}),Object(te.jsx)(K.a,{name:"sigma",cellRenderer:function(e){return Object(te.jsx)(W.a,{children:"".concat(a[e]?Q(a[e][1]):0)})}}),Object(te.jsx)(K.a,{name:"amplitude",cellRenderer:function(e){return Object(te.jsx)(W.a,{children:"".concat(a[e]?Q(a[e][2]):0)})}})]})]})},oe=ie,re=t.p+"static/media/salsasource.c1a4e165.py",le=(t(159),function(){var e=Object(u.a)(l.a.mark((function e(){var n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"});case 2:return n=e.sent,e.next=5,n.loadPackage(["astropy","scipy"]);case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),ue=function(){var e=Object(u.a)(l.a.mark((function e(n,t){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.runPythonAsync(t);case 2:return a=n.globals.get("salsa"),console.log("globals",a),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();var be=function(){Object(f.b)();var e=Object(a.useRef)(null),n=Object(a.useState)(!1),t=Object(o.a)(n,2),i=t[0],s=t[1],c=Object(a.useState)(""),r=Object(o.a)(c,2),j=r[0],h=r[1],O=Object(a.useState)("freq"),x=Object(o.a)(O,2),p=x[0],m=x[1],g=Object(a.useState)(),v=Object(o.a)(g,2),y=v[0],w=v[1],T=Object(a.useState)(!1),S=Object(o.a)(T,2),P=S[0],F=S[1];Object(a.useEffect)((function(){function n(){return(n=Object(u.a)(l.a.mark((function n(){return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i){n.next=7;break}return n.next=3,le();case 3:e.current=n.sent,s(!0),n.next=8;break;case 7:console.log("no duplicate reload to avoid pyodide error");case 8:case"end":return n.stop()}}),n)})))).apply(this,arguments)}!function(){n.apply(this,arguments)}()}));var k=function(){var n=Object(u.a)(l.a.mark((function n(t){var a,i;return l.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(re);case 2:return n.next=4,n.sent.text();case 4:return a=n.sent,n.next=7,ue(e.current,a);case 7:i=n.sent,h(t.name),w(i);case 10:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),C=y&&Array.from(y.header.toJs(),(function(e){var n=Object(o.a)(e,2),t=n[0],a=n[1];return"".concat(t," = ").concat(a)}));return Object(te.jsxs)("div",{className:"App",children:[Object(te.jsxs)(b.n,{children:[Object(te.jsxs)(b.p,{align:d.a.LEFT,children:[Object(te.jsx)(b.q,{children:"SalsaTS"}),Object(te.jsx)(b.o,{}),Object(te.jsx)(b.b,{disabled:!i,minimal:!0,children:Object(te.jsxs)("label",{htmlFor:"input",children:[Object(te.jsx)("input",{type:"file",id:"input",hidden:!0,onChange:function(e){!function(e){if(e){console.log("processing file:",e);var n=new FileReader;n.onabort=function(){return console.log("file reading was aborted")},n.onerror=function(){return console.log("file reading has failed")},n.onload=function(){window.jsarray=new Float32Array(n.result),k(e)},n.readAsArrayBuffer(e)}}(e.target.files[0])}}),Object(te.jsx)(b.l,{icon:"document"})," Upload"]})})]}),Object(te.jsxs)(b.p,{align:d.a.RIGHT,children:[Object(te.jsx)(b.b,{icon:"help",text:"Help",minimal:!0,onClick:function(e){e.preventDefault(),window.open("https://github.com/appolloford/salsa-ts/wiki","_blank","noopener,noreferrer")}}),Object(te.jsx)(b.b,{icon:"app-header",text:"Header",minimal:!0,onClick:function(){return F(!0)}})]})]}),Object(te.jsx)(oe,{fileName:j,dataSource:y,unit:p,setUnit:m}),Object(te.jsx)(b.h,{isOpen:P,onClose:function(){return F(!1)},children:Object(te.jsx)(b.d,{children:C&&C.map((function(e){return Object(te.jsx)("div",{children:e})}))})})]})},de=function(e){e&&e instanceof Function&&t.e(3).then(t.bind(null,176)).then((function(n){var t=n.getCLS,a=n.getFID,i=n.getFCP,s=n.getLCP,c=n.getTTFB;t(e),a(e),i(e),s(e),c(e)}))},je=Object(h.a)({reducer:{cursor:g,baseline:k,gaussian:_}});c.a.render(Object(te.jsx)(i.a.StrictMode,{children:Object(te.jsx)(f.a,{store:je,children:Object(te.jsx)(be,{})})}),document.getElementById("root")),de()}},[[160,1,2]]]);
//# sourceMappingURL=main.10eccd51.chunk.js.map