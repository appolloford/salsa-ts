(this["webpackJsonpsalsa-ts"]=this["webpackJsonpsalsa-ts"]||[]).push([[0],{133:function(e,t,n){},159:function(e,t,n){},160:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),c=n(13),o=n.n(c),s=(n(133),n(22)),r=n(24),l=n.n(r),u=n(41),d=n(161),j=n(36),b=n(40),f=n(175),x=n(81),O=n(42),p=n(15),h=n(25),g=Object(h.b)({name:"cursor",initialState:{position:[0,0],drag:"zoom"},reducers:{setPosition:function(e,t){e.position=t.payload},setDrag:function(e,t){e.drag=t.payload}}}),v=g.actions,m=v.setPosition,y=v.setDrag,P=g.reducer,k=Object(h.b)({name:"baseline",initialState:{dataPoints:[],fitValues:[],subtraction:!1},reducers:{setDataPoints:function(e,t){e.dataPoints=t.payload},setFitValues:function(e,t){e.fitValues=t.payload},setSubtraction:function(e,t){e.subtraction=t.payload}}}),F=k.actions,T=F.setDataPoints,w=F.setFitValues,C=F.setSubtraction,S=k.reducer,A=Object(h.b)({name:"gaussian",initialState:{order:0,isFitting:!1,guess:[],params:[],fit:[]},reducers:{setOrder:function(e,t){e.order=t.payload},setIsFitting:function(e,t){e.isFitting=t.payload},setGaussianGuess:function(e,t){e.guess=t.payload},setGaussianFit:function(e,t){e.fit=t.payload}}}),E=A.actions,z=E.setOrder,L=E.setIsFitting,R=E.setGaussianGuess,G=E.setGaussianFit,_=A.reducer,q=n(21),V=n.n(q),I=n(75),N=n.n(I),H=n(76),B=n.n(H),J=n(77),D=n.n(J),U=n(16),M=n(2),Y=n(82),W=n(53),X=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return 0;var n=e.toExponential().split("e").map((function(e){return Number(e)})),i=Object(s.a)(n,2),a=i[0],c=i[1];return 0===c?"".concat(a.toFixed(t)):"".concat(a.toFixed(t),"x10^").concat(c)},K=n(6);B()(V.a),D()(V.a),n(141)(V.a),n(142)(V.a);var Q=Object(i.memo)((function(e){var t,n,a,c=Object(p.b)(),o=Object(p.c)((function(e){return e.cursor.drag})),r="baseline"===o||"gaussian"===o,l=Object(p.c)((function(e){return e.baseline.fitValues})),u=Object(p.c)((function(e){return e.baseline.subtraction})),d=l.length>0,j=Object(p.c)((function(e){return e.gaussian.order})),b=Object(p.c)((function(e){return e.gaussian.isFitting})),f=Object(p.c)((function(e){return e.gaussian.guess})),x=Object(p.c)((function(e){return e.gaussian.fit})),h=Object(i.useRef)(null),g=null===(t=h.current)||void 0===t?void 0:t.chart,v=e.fileName,y=e.dataSource,P=e.unit,k=e.setUnit;"baseline"===o?n=function(e){console.log(e),console.log(g),console.log("chart option",null===g||void 0===g?void 0:g.options),(null===g||void 0===g?void 0:g.series)&&g.series.forEach((function(t){!0===t.options.allowPointSelect&&(null===t||void 0===t||t.points.forEach((function(t){t.x>=e.xAxis[0].min&&t.x<=e.xAxis[0].max&&t.y>=e.yAxis[0].min&&t.y<=e.yAxis[0].max&&t.select(!0,!0)})))}));var t=(null===g||void 0===g?void 0:g.getSelectedPoints().map((function(e){return[e.x||0,e.y||0]})))||[];return c(T(t)),!1}:"gaussian"===o&&(n=function(e){var t=[e.xAxis[0].min,e.xAxis[0].max,e.yAxis[0].min,e.yAxis[0].max];return c(R([].concat(Object(O.a)(f),[t]))),b&&function(e,t){var n=null===y||void 0===y?void 0:y.fit_gaussian(P,e,t).toJs(),i=[].slice.call(n);c(G(i))}(j,[].concat(Object(O.a)(f),[t])),!1}),a="freq-k"===P?"kHz":"freq-m"===P?"MHz":"freq-g"===P?"GHz":"chan"===P?"Channel":"vel"===P?"Velocity (km/s)":"Hz";var F={chart:{zoomType:"x"},tooltip:{enabled:!0},plotOptions:{series:{enableMouseTracking:!0,tooltip:{followPointer:!1},events:{click:function(e){c(R(f.filter((function(t,n){return n!==e.point.series.index-(3-Number(u))}))))}}}}},w=[];if(y){var C=y.axisdata(1,P).toJs(),S=y.rawdata.toJs()[0][0],A=y.header.toJs(),E=[].slice.call(C);w=E.map((function(e,t){return[e,S[t]]}));var z=E.map((function(e,t){return[e,0]}));if(!0===d&&z.forEach((function(e,t){e[1]=l[t]})),!0===u){var L=w.map((function(e,t){return[e[0],e[1]-z[t][1]]}));F.series=[{name:"Observation - Baseline",type:"scatter",data:L,findNearestPointBy:"xy"}]}else F.series=[{name:"Observation",type:"scatter",lineWidth:2,data:w,allowPointSelect:r,findNearestPointBy:"xy"}],!0===d&&F.series.push({name:"Baseline fitting",type:"line",data:z,allowPointSelect:!1,colorIndex:3}),console.log("series",F.series);if(x){var _=E.map((function(e,t){return[e,0]}));_.forEach((function(e,t){e[1]=x[t]})),F.series.push({name:"Gaussian",type:"line",data:_,findNearestPointBy:"xy",colorIndex:5})}if(f){var q=f.map((function(e,t){var n=Object(s.a)(e,4),i=n[0],a=n[1],c=n[2],o=n[3];return{name:"Peak ".concat(t+1),type:"polygon",data:[[i,c],[a,c],[a,o],[i,o]],color:"green",opacity:.5}}));q&&(F.series=[].concat(Object(O.a)(F.series),Object(O.a)(q)))}var I="".concat(A.get("CTYPE2"),": ").concat(X(A.get("CRVAL2")),", ").concat(A.get("CTYPE3"),": ").concat(X(A.get("CRVAL3")));F.title={text:v},F.subtitle={text:I};var H={title:{text:a}},B={title:{text:A.get("BUNIT")}};F.xAxis=H,F.yAxis=B}!0===r&&F.chart?(F.chart.zoomType="xy",F.chart.renderTo=null===g||void 0===g?void 0:g.container,F.chart.events={selection:n,click:function(){var e=null===g||void 0===g?void 0:g.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)})),c(T([]))}}):F.chart&&(F.chart.zoomType="x",F.chart.events={selection:void 0,click:void 0,render:void 0}),console.log("options",F);return Object(K.jsxs)("div",{children:[Object(K.jsx)(N.a,{highcharts:V.a,options:F,ref:h,containerProps:{onMouseMove:function(e){var t=function(e){var t=0,n=0;if(g){var i=g.pointer.normalize(e),a=i.chartX-g.plotLeft,c=i.chartY-g.plotTop;a>=0&&c>=0&&a<=g.chartWidth&&c<=g.chartHeight&&(t=g.xAxis[0].toValue(a,!0),n=g.yAxis[0].toValue(c,!0))}return{xPos:t,yPos:n}}(e),n=t.xPos,i=t.yPos;c(m([n,i]))}}}),Object(K.jsx)(Z,{unit:P,setUnit:k,dataSource:y,unSelectAllPoints:function(){var e=null===g||void 0===g?void 0:g.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)}))}})]})})),Z=function(e){var t=Object(p.b)(),n=Object(p.c)((function(e){return e.cursor.drag})),i=Object(p.c)((function(e){return e.baseline.dataPoints})),a=Object(p.c)((function(e){return e.baseline.fitValues})),c=Object(p.c)((function(e){return e.baseline.subtraction})),o=a.length>0,s=i.map((function(e){return e[0]})),r=i.map((function(e){return e[1]})),l=Object(p.c)((function(e){return e.gaussian.order})),u=Object(p.c)((function(e){return e.gaussian.isFitting})),j=Object(p.c)((function(e){return e.gaussian.guess})),b=e.dataSource,f=e.unit,x=e.setUnit,O=e.unSelectAllPoints,h=function(e,n){var i=null===b||void 0===b?void 0:b.fit_baseline(e,n,f).toJs(),a=[].slice.call(i);t(w(a))},g=function(e){var n=null===b||void 0===b?void 0:b.fit_gaussian(f,e,j).toJs(),i=[].slice.call(n);t(G(i))};return Object(K.jsxs)("div",{style:{display:"flex"},children:[Object(K.jsxs)(d.c,{children:[Object(K.jsx)(Y.a,{content:"Cursor action: drag to zoom",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"zoom-in",small:!0,active:"zoom"===n,onClick:function(){t(y("zoom"))}})}),Object(K.jsx)(Y.a,{content:"Cursor action: select baseline points",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"widget-button",small:!0,active:"baseline"===n,disabled:c,onClick:function(){t(y("baseline"))}})}),Object(K.jsx)(Y.a,{content:"Cursor action: select gaussian peak ranges",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"widget",small:!0,active:"gaussian"===n,disabled:!o||!c,onClick:function(){t(y("gaussian"))}})})]}),Object(K.jsx)(d.f,{}),Object(K.jsx)(Y.a,{content:"Subtraction baseline",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"bring-data",small:!0,active:c,onClick:function(){t(C(!c)),t(y("zoom"))}})}),Object(K.jsx)(Y.a,{content:"Fit baseline",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"regression-chart",small:!0,disabled:!i.length,onClick:function(){h(s,r)}})}),Object(K.jsx)(Y.a,{content:"Remove all baseline data",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){O(),t(T([])),h([],[])}})}),Object(K.jsx)(d.f,{}),Object(K.jsx)(Y.a,{className:M.a.TOOLTIP_INDICATOR,content:"Fit Gaussian",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"timeline-bar-chart",small:!0,active:u,disabled:!i.length||!c,onClick:function(){u?t(G([])):g(l),t(L(!u))}})}),Object(K.jsx)(W.a,{content:Object(K.jsx)(d.q,{style:{width:30},value:l,min:0,onValueChange:function(e){t(z(e)),u&&g(e)}}),children:Object(K.jsx)(Y.a,{content:"Number of Gaussian peaks",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{text:l,small:!0})})}),Object(K.jsx)(Y.a,{content:"Remove all gaussian data",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){t(L(!1)),t(R([])),t(G([]))}})}),Object(K.jsx)(d.g,{style:{marginLeft:"auto",height:10},label:"x-axis unit:",inline:!0,children:Object(K.jsxs)(d.h,{value:f,minimal:!0,onChange:function(e){x(e.target.value)},children:[Object(K.jsx)("option",{value:"freq",children:"Frequency (Hz)"}),Object(K.jsx)("option",{value:"freq-k",children:"Frequency (kHz)"}),Object(K.jsx)("option",{value:"freq-m",children:"Frequency (MHz)"}),Object(K.jsx)("option",{value:"freq-g",children:"Frequency (GHz)"}),Object(K.jsx)("option",{value:"chan",children:"Channel"}),Object(K.jsx)("option",{value:"vel",children:"Velocity (km/s)"})]})})]})},$=Q,ee=n.p+"static/media/salsasource.74c361a6.py",te=(n(159),function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"});case 2:return t=e.sent,e.next=5,t.loadPackage(["astropy","scipy"]);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),ne=function(){var e=Object(u.a)(l.a.mark((function e(t,n){var i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.runPythonAsync(n);case 2:return i=t.globals.get("salsa"),console.log("globals",i),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var ie=function(e){var t=Object(p.c)((function(e){return e.cursor.position}));return Object(K.jsx)("div",{style:{textAlign:"left"},children:Object(K.jsxs)(d.l,{children:["Position: (",X(t[0]),", ",X(t[1]),")"]})})},ae=function(e){var t=Object(p.c)((function(e){return e.baseline.dataPoints}));return Object(K.jsx)(d.d,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(K.jsxs)(f.a,{numRows:t.length,enableGhostCells:!0,children:[Object(K.jsx)(x.a,{name:"X coordinate",cellRenderer:function(e){return Object(K.jsx)(b.a,{children:"".concat(t[e]?X(t[e][0]):0)})}}),Object(K.jsx)(x.a,{name:"Y coordinate",cellRenderer:function(e){return Object(K.jsx)(b.a,{children:"".concat(t[e]?X(t[e][1]):0)})}})]})})},ce=function(e){var t=Object(p.c)((function(e){return e.gaussian.guess}));return Object(K.jsx)(d.d,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(K.jsxs)(f.a,{numRows:t.length,enableGhostCells:!0,columnWidths:[300,200],children:[Object(K.jsx)(x.a,{name:"X range",cellRenderer:function(e){return Object(K.jsxs)(b.a,{children:["(","".concat(t[e]?X(t[e][0]):0),","," ".concat(t[e]?X(t[e][1]):0),")"]})}}),Object(K.jsx)(x.a,{name:"Y range",cellRenderer:function(e){return Object(K.jsxs)(b.a,{children:["(","".concat(t[e]?X(t[e][2]):0),","," ".concat(t[e]?X(t[e][3]):0),")"]})}})]})})},oe=function(){Object(p.b)();var e=Object(i.useRef)(null),t=Object(i.useState)(!1),n=Object(s.a)(t,2),a=n[0],c=n[1],o=Object(i.useState)(""),r=Object(s.a)(o,2),b=r[0],f=r[1],x=Object(i.useState)("freq"),O=Object(s.a)(x,2),h=O[0],g=O[1],v=Object(i.useState)(),m=Object(s.a)(v,2),y=m[0],P=m[1];Object(i.useEffect)((function(){function t(){return(t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=7;break}return t.next=3,te();case 3:e.current=t.sent,c(!0),t.next=8;break;case 7:console.log("no duplicate reload to avoid pyodide error");case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}));var k=function(){var t=Object(u.a)(l.a.mark((function t(n){var i,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(ee);case 2:return t.next=4,t.sent.text();case 4:return i=t.sent,t.next=7,ne(e.current,i);case 7:a=t.sent,f(n.name),P(a);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(K.jsxs)("div",{className:"App",children:[Object(K.jsxs)(d.m,{children:[Object(K.jsxs)(d.o,{align:j.a.LEFT,children:[Object(K.jsx)(d.p,{children:"SalsaTS"}),Object(K.jsx)(d.n,{}),Object(K.jsx)(d.b,{disabled:!a,minimal:!0,children:Object(K.jsxs)("label",{htmlFor:"input",children:[Object(K.jsx)("input",{type:"file",id:"input",hidden:!0,onChange:function(e){!function(e){if(e){console.log("processing file:",e);var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){window.jsarray=new Float32Array(t.result),k(e)},t.readAsArrayBuffer(e)}}(e.target.files[0])}}),Object(K.jsx)(d.j,{icon:"document"})," Upload"]})})]}),Object(K.jsx)(d.o,{align:j.a.RIGHT,children:Object(K.jsx)(d.b,{icon:"help",text:"Help",minimal:!0,onClick:function(e){e.preventDefault(),window.open("https://github.com/appolloford/salsa-ts/wiki","_blank","noopener,noreferrer")}})})]}),Object(K.jsx)($,{fileName:b,dataSource:y,unit:h,setUnit:g}),Object(K.jsx)("div",{style:{display:"flex"},children:Object(K.jsx)("div",{style:{flex:1},children:Object(K.jsxs)(d.v,{children:[Object(K.jsx)(d.u,{id:"cursorpanel",title:"Cursor Information",panel:Object(K.jsx)(ie,{})}),Object(K.jsx)(d.u,{id:"baselinepoints",title:"Selected Baseline Points",panel:Object(K.jsx)(ae,{})}),Object(K.jsx)(d.u,{id:"gaussianranges",title:"Selected Gaussian Ranges",panel:Object(K.jsx)(ce,{})})]})})})]})},se=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,176)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),i(e),a(e),c(e),o(e)}))},re=Object(h.a)({reducer:{cursor:P,baseline:S,gaussian:_}});o.a.render(Object(K.jsx)(a.a.StrictMode,{children:Object(K.jsx)(p.a,{store:re,children:Object(K.jsx)(oe,{})})}),document.getElementById("root")),se()}},[[160,1,2]]]);
//# sourceMappingURL=main.8386d578.chunk.js.map