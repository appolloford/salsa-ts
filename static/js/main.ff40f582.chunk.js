(this["webpackJsonpsalsa-ts"]=this["webpackJsonpsalsa-ts"]||[]).push([[0],{133:function(e,t,n){},159:function(e,t,n){},160:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),c=n(14),o=n.n(c),s=(n(133),n(20)),r=n(24),l=n.n(r),u=n(41),d=n(161),b=n(36),j=n(42),f=n(13),h=n(25),O=Object(h.b)({name:"cursor",initialState:{position:[0,0],drag:"zoom"},reducers:{setPosition:function(e,t){e.position=t.payload},setDrag:function(e,t){e.drag=t.payload}}}),x=O.actions,p=x.setPosition,v=x.setDrag,m=O.reducer,g=Object(h.b)({name:"baseline",initialState:{dataPoints:[],fitValues:[],subtraction:!1,showBaselineTable:!1},reducers:{setDataPoints:function(e,t){e.dataPoints=t.payload},setFitValues:function(e,t){e.fitValues=t.payload},setSubtraction:function(e,t){e.subtraction=t.payload},setShowBaselineTable:function(e,t){e.showBaselineTable=t.payload}}}),y=g.actions,T=y.setDataPoints,w=y.setFitValues,P=y.setSubtraction,k=y.setShowBaselineTable,F=g.reducer,S=Object(h.b)({name:"gaussian",initialState:{order:0,isFitting:!1,guess:[],params:[],fit:[],showGaussianTable:!1},reducers:{setOrder:function(e,t){e.order=t.payload},setIsFitting:function(e,t){e.isFitting=t.payload},setGaussianGuess:function(e,t){e.guess=t.payload},setGaussianFit:function(e,t){e.fit=t.payload},setShowGaussianTable:function(e,t){e.showGaussianTable=t.payload}}}),C=S.actions,A=C.setOrder,E=C.setIsFitting,q=C.setGaussianGuess,L=C.setGaussianFit,z=C.setShowGaussianTable,G=S.reducer,R=n(22),_=n.n(R),B=n(75),N=n.n(B),V=n(76),H=n.n(V),I=n(77),J=n.n(I),D=n(40),U=n(175),M=n(81),Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return(e=0).toFixed(t);var n=e.toExponential().split("e").map((function(e){return Number(e)})),i=Object(s.a)(n,2),a=i[0],c=i[1];return 0===c?"".concat(a.toFixed(t)):"".concat(a.toFixed(t),"x10^").concat(c)},W=n(15),X=n(2),K=n(82),Q=n(53),Z=n(6),$=function(e){var t=Object(f.b)(),n=Object(f.c)((function(e){return e.cursor.position})),i=Object(f.c)((function(e){return e.cursor.drag})),a=Object(f.c)((function(e){return e.baseline.dataPoints})),c=Object(f.c)((function(e){return e.baseline.fitValues})),o=Object(f.c)((function(e){return e.baseline.subtraction})),r=c.length>0,l=a.map((function(e){return e[0]})),u=a.map((function(e){return e[1]})),b=Object(f.c)((function(e){return e.gaussian.order})),j=Object(f.c)((function(e){return e.gaussian.isFitting})),h=Object(f.c)((function(e){return e.gaussian.guess})),O=e.dataSource,x=e.unit,p=e.setUnit,m=e.unSelectAllPoints,g=function(e,n){var i=null===O||void 0===O?void 0:O.fit_baseline(e,n,x).toJs(),a=[].slice.call(i);t(w(a))},y=function(e){var n=h.map((function(e){var t=Object(s.a)(e,4),n=t[0],i=t[1],a=t[2],c=t[3],o=null===O||void 0===O?void 0:O.convertfreq(n,x),r=null===O||void 0===O?void 0:O.convertfreq(i,x);return[o<=r?o:r,o<=r?r:o,a,c]})),i=null===O||void 0===O?void 0:O.fit_gaussian(x,e,n).toJs(),a=[].slice.call(i);t(L(a))},F=Object(f.c)((function(e){return e.baseline.showBaselineTable})),S=Object(f.c)((function(e){return e.gaussian.showGaussianTable}));return Object(Z.jsxs)("div",{style:{display:"flex"},children:[Object(Z.jsxs)(d.c,{children:[Object(Z.jsx)(K.a,{content:"Cursor action: drag to zoom",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"zoom-in",small:!0,active:"zoom"===i,onClick:function(){t(v("zoom"))}})}),Object(Z.jsx)(K.a,{content:"Cursor action: select baseline points",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"widget-button",small:!0,active:"baseline"===i,disabled:o,onClick:function(){t(v("baseline"))}})}),Object(Z.jsx)(K.a,{content:"Cursor action: select gaussian peak ranges",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"widget",small:!0,active:"gaussian"===i,disabled:!r||!o,onClick:function(){t(v("gaussian"))}})})]}),Object(Z.jsx)(d.g,{}),Object(Z.jsx)(K.a,{content:"Subtraction baseline",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"bring-data",small:!0,active:o,onClick:function(){t(P(!o)),t(v("zoom"))}})}),Object(Z.jsx)(K.a,{content:"Fit baseline",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"regression-chart",small:!0,disabled:!a.length,onClick:function(){g(l,u)}})}),Object(Z.jsx)(K.a,{content:"Show baseline table",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"th",small:!0,onClick:function(){t(k(!F))}})}),Object(Z.jsx)(K.a,{content:"Remove all baseline data",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){m(),t(T([])),g([],[])}})}),Object(Z.jsx)(d.g,{}),Object(Z.jsx)(K.a,{className:X.a.TOOLTIP_INDICATOR,content:"Fit Gaussian",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"timeline-bar-chart",small:!0,active:j,disabled:!a.length||!o,onClick:function(){j?t(L([])):y(b),t(E(!j))}})}),Object(Z.jsx)(Q.a,{content:Object(Z.jsx)(d.r,{style:{width:30},value:b,min:0,onValueChange:function(e){t(A(e)),j&&y(e)}}),children:Object(Z.jsx)(K.a,{content:"Number of Gaussian peaks",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{text:b,small:!0})})}),Object(Z.jsx)(K.a,{content:"Show gaussian table",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"th",small:!0,onClick:function(){t(z(!S))}})}),Object(Z.jsx)(K.a,{content:"Remove all gaussian data",position:W.a.TOP_LEFT,minimal:!0,children:Object(Z.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){t(E(!1)),t(q([])),t(L([]))}})}),Object(Z.jsxs)(d.b,{style:{marginLeft:"auto",height:10},small:!0,minimal:!0,disabled:!0,children:["(x, y) = (",Y(n[0]),", ",Y(n[1]),")"]}),Object(Z.jsx)(d.i,{style:{marginLeft:"auto",height:10},label:"x-axis unit:",inline:!0,children:Object(Z.jsxs)(d.j,{value:x,minimal:!0,onChange:function(e){p(e.target.value)},children:[Object(Z.jsx)("option",{value:"freq",children:"Frequency (Hz)"}),Object(Z.jsx)("option",{value:"freq-k",children:"Frequency (kHz)"}),Object(Z.jsx)("option",{value:"freq-m",children:"Frequency (MHz)"}),Object(Z.jsx)("option",{value:"freq-g",children:"Frequency (GHz)"}),Object(Z.jsx)("option",{value:"chan",children:"Channel"}),Object(Z.jsx)("option",{value:"vel",children:"Velocity (km/s)"})]})})]})};H()(_.a),J()(_.a),n(157)(_.a),n(158)(_.a);var ee=Object(i.memo)((function(e){var t,n,a=Object(f.b)(),c=Object(f.c)((function(e){return e.cursor.drag})),o=Object(f.c)((function(e){return e.baseline.fitValues})),r=Object(f.c)((function(e){return e.baseline.subtraction})),l=Object(f.c)((function(e){return e.baseline.showBaselineTable})),u=o.length>0,b=Object(f.c)((function(e){return e.gaussian.order})),h=Object(f.c)((function(e){return e.gaussian.isFitting})),O=Object(f.c)((function(e){return e.gaussian.guess})),x=Object(f.c)((function(e){return e.gaussian.fit})),v=Object(f.c)((function(e){return e.gaussian.showGaussianTable})),m=250/(Number(l)+Number(v)),g=Object(i.useRef)(null),y=null===(t=g.current)||void 0===t?void 0:t.chart,w=e.fileName,P=e.dataSource,k=e.unit,F=e.setUnit;n="freq-k"===k?"kHz":"freq-m"===k?"MHz":"freq-g"===k?"GHz":"chan"===k?"Channel":"vel"===k?"Velocity (km/s)":"Hz";var S={chart:{zoomType:"x"},tooltip:{enabled:!0},plotOptions:{series:{enableMouseTracking:!0,tooltip:{followPointer:!1},events:{click:function(e){a(q(O.filter((function(t,n){return n!==e.point.series.index-(3-Number(r))}))))}}}}},C=[];if(P){var A=P.axisdata(1,k).toJs(),E=P.rawdata.toJs()[0][0],z=P.header.toJs(),G=[].slice.call(A);C=G.map((function(e,t){return[e,E[t]]}));var R=G.map((function(e,t){return[e,0]}));if(!0===u&&R.forEach((function(e,t){e[1]=o[t]})),!0===r){var B=C.map((function(e,t){return[e[0],e[1]-R[t][1]]}));S.series=[{name:"Observation - Baseline",type:"scatter",data:B,findNearestPointBy:"xy"}]}else S.series=[{name:"Observation",type:"scatter",lineWidth:2,data:C,allowPointSelect:"zoom"!==c,findNearestPointBy:"xy"}],!0===u&&S.series.push({name:"Baseline fitting",type:"line",data:R,allowPointSelect:!1,colorIndex:3}),console.log("series",S.series);if(x){var V=G.map((function(e,t){return[e,0]}));V.forEach((function(e,t){e[1]=x[t]})),S.series.push({name:"Gaussian",type:"line",data:V,findNearestPointBy:"xy",colorIndex:5})}if(O){var H=O.map((function(e,t){var n=Object(s.a)(e,4),i=n[0],a=n[1],c=n[2],o=n[3],r=null===P||void 0===P?void 0:P.convertfreq(i,k),l=null===P||void 0===P?void 0:P.convertfreq(a,k);return{name:"Peak ".concat(t+1),type:"polygon",data:[[r,c],[l,c],[l,o],[r,o]],color:"green",opacity:.5}}));H&&(S.series=[].concat(Object(j.a)(S.series),Object(j.a)(H)))}var I="".concat(z.get("CTYPE2"),": ").concat(Y(z.get("CRVAL2")),", ").concat(z.get("CTYPE3"),": ").concat(Y(z.get("CRVAL3")));S.title={text:w},S.subtitle={text:I};var J={title:{text:n}},D={title:{text:z.get("BUNIT")}};S.xAxis=J,S.yAxis=D}"baseline"===c&&S.chart?(S.chart.zoomType="xy",S.chart.renderTo=null===y||void 0===y?void 0:y.container,S.chart.events={selection:function(e){console.log(e),console.log(y),console.log("chart option",null===y||void 0===y?void 0:y.options),(null===y||void 0===y?void 0:y.series)&&y.series.forEach((function(t){!0===t.options.allowPointSelect&&(null===t||void 0===t||t.points.forEach((function(t){t.x>=e.xAxis[0].min&&t.x<=e.xAxis[0].max&&t.y>=e.yAxis[0].min&&t.y<=e.yAxis[0].max&&t.select(!0,!0)})))}));var t=(null===y||void 0===y?void 0:y.getSelectedPoints().map((function(e){return[e.x||0,e.y||0]})))||[];return a(T(t)),!1},click:function(){var e=null===y||void 0===y?void 0:y.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)})),a(T([]))}}):"gaussian"===c&&S.chart?(S.chart.zoomType="xy",S.chart.renderTo=null===y||void 0===y?void 0:y.container,S.chart.events={selection:function(e){var t=[null===P||void 0===P?void 0:P.convert2freq(e.xAxis[0].min,k),null===P||void 0===P?void 0:P.convert2freq(e.xAxis[0].max,k),e.yAxis[0].min,e.yAxis[0].max];return a(q([].concat(Object(j.a)(O),[t]))),h&&function(e,t){var n=t.map((function(e){var t=Object(s.a)(e,4),n=t[0],i=t[1],a=t[2],c=t[3],o=null===P||void 0===P?void 0:P.convertfreq(n,k),r=null===P||void 0===P?void 0:P.convertfreq(i,k);return[o<=r?o:r,o<=r?r:o,a,c]})),i=null===P||void 0===P?void 0:P.fit_gaussian(k,e,n).toJs(),c=[].slice.call(i);a(L(c))}(b,[].concat(Object(j.a)(O),[t])),!1}}):S.chart&&(S.chart.zoomType="x",S.chart.events={selection:void 0,click:void 0,render:void 0}),console.log("options",S);return Object(Z.jsxs)("div",{children:[Object(Z.jsx)(N.a,{highcharts:_.a,options:S,ref:g,containerProps:{onMouseMove:function(e){var t=function(e){var t=0,n=0;if(y){var i=y.pointer.normalize(e),a=i.chartX-y.plotLeft,c=i.chartY-y.plotTop;a>=0&&c>=0&&a<=y.chartWidth&&c<=y.chartHeight&&(t=y.xAxis[0].toValue(a,!0),n=y.yAxis[0].toValue(c,!0))}return{xPos:t,yPos:n}}(e),n=t.xPos,i=t.yPos;a(p([n,i]))}}}),Object(Z.jsx)($,{unit:k,setUnit:F,dataSource:P,unSelectAllPoints:function(){var e=null===y||void 0===y?void 0:y.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)}))}}),Object(Z.jsx)(d.g,{}),Object(Z.jsx)(d.e,{isOpen:l,children:Object(Z.jsx)(te,{height:m})}),Object(Z.jsx)(d.e,{isOpen:v,children:Object(Z.jsx)(ne,{height:m})})]})})),te=function(e){var t=Object(f.c)((function(e){return e.baseline.dataPoints}));return Object(Z.jsxs)(d.d,{style:{display:"block",overflow:"auto",height:e.height},children:["Selected Points:",Object(Z.jsxs)(U.a,{numRows:t.length,enableGhostCells:!0,columnWidths:[400,400],children:[Object(Z.jsx)(M.a,{name:"X coordinate",cellRenderer:function(e){return Object(Z.jsx)(D.a,{children:"".concat(t[e]?Y(t[e][0]):0)})}}),Object(Z.jsx)(M.a,{name:"Y coordinate",cellRenderer:function(e){return Object(Z.jsx)(D.a,{children:"".concat(t[e]?Y(t[e][1]):0)})}})]})]})},ne=function(e){var t=Object(f.c)((function(e){return e.gaussian.guess}));return Object(Z.jsxs)(d.d,{style:{display:"block",overflow:"auto",height:e.height},children:["Constraints:",Object(Z.jsxs)(U.a,{numRows:t.length,enableGhostCells:!0,columnWidths:[400,400],children:[Object(Z.jsx)(M.a,{name:"X range",cellRenderer:function(e){return Object(Z.jsxs)(D.a,{children:["(","".concat(t[e]?Y(t[e][0]):0),","," ".concat(t[e]?Y(t[e][1]):0),")"]})}}),Object(Z.jsx)(M.a,{name:"Y range",cellRenderer:function(e){return Object(Z.jsxs)(D.a,{children:["(","".concat(t[e]?Y(t[e][2]):0),","," ".concat(t[e]?Y(t[e][3]):0),")"]})}})]})]})},ie=ee,ae=n.p+"static/media/salsasource.1eae1293.py",ce=(n(159),function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"});case 2:return t=e.sent,e.next=5,t.loadPackage(["astropy","scipy"]);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),oe=function(){var e=Object(u.a)(l.a.mark((function e(t,n){var i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.runPythonAsync(n);case 2:return i=t.globals.get("salsa"),console.log("globals",i),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var se=function(){Object(f.b)();var e=Object(i.useRef)(null),t=Object(i.useState)(!1),n=Object(s.a)(t,2),a=n[0],c=n[1],o=Object(i.useState)(""),r=Object(s.a)(o,2),j=r[0],h=r[1],O=Object(i.useState)("freq"),x=Object(s.a)(O,2),p=x[0],v=x[1],m=Object(i.useState)(),g=Object(s.a)(m,2),y=g[0],T=g[1],w=Object(i.useState)(!1),P=Object(s.a)(w,2),k=P[0],F=P[1];Object(i.useEffect)((function(){function t(){return(t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=7;break}return t.next=3,ce();case 3:e.current=t.sent,c(!0),t.next=8;break;case 7:console.log("no duplicate reload to avoid pyodide error");case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}));var S=function(){var t=Object(u.a)(l.a.mark((function t(n){var i,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(ae);case 2:return t.next=4,t.sent.text();case 4:return i=t.sent,t.next=7,oe(e.current,i);case 7:a=t.sent,h(n.name),T(a);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),C=y&&Array.from(y.header.toJs(),(function(e){var t=Object(s.a)(e,2),n=t[0],i=t[1];return"".concat(n," = ").concat(i)}));return Object(Z.jsxs)("div",{className:"App",children:[Object(Z.jsxs)(d.n,{children:[Object(Z.jsxs)(d.p,{align:b.a.LEFT,children:[Object(Z.jsx)(d.q,{children:"SalsaTS"}),Object(Z.jsx)(d.o,{}),Object(Z.jsx)(d.b,{disabled:!a,minimal:!0,children:Object(Z.jsxs)("label",{htmlFor:"input",children:[Object(Z.jsx)("input",{type:"file",id:"input",hidden:!0,onChange:function(e){!function(e){if(e){console.log("processing file:",e);var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){window.jsarray=new Float32Array(t.result),S(e)},t.readAsArrayBuffer(e)}}(e.target.files[0])}}),Object(Z.jsx)(d.l,{icon:"document"})," Upload"]})})]}),Object(Z.jsxs)(d.p,{align:b.a.RIGHT,children:[Object(Z.jsx)(d.b,{icon:"help",text:"Help",minimal:!0,onClick:function(e){e.preventDefault(),window.open("https://github.com/appolloford/salsa-ts/wiki","_blank","noopener,noreferrer")}}),Object(Z.jsx)(d.b,{icon:"app-header",text:"Header",minimal:!0,onClick:function(){return F(!0)}})]})]}),Object(Z.jsx)(ie,{fileName:j,dataSource:y,unit:p,setUnit:v}),Object(Z.jsx)(d.h,{isOpen:k,onClose:function(){return F(!1)},children:Object(Z.jsx)(d.d,{children:C&&C.map((function(e){return Object(Z.jsx)("div",{children:e})}))})})]})},re=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,176)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),i(e),a(e),c(e),o(e)}))},le=Object(h.a)({reducer:{cursor:m,baseline:F,gaussian:G}});o.a.render(Object(Z.jsx)(a.a.StrictMode,{children:Object(Z.jsx)(f.a,{store:le,children:Object(Z.jsx)(se,{})})}),document.getElementById("root")),re()}},[[160,1,2]]]);
//# sourceMappingURL=main.ff40f582.chunk.js.map