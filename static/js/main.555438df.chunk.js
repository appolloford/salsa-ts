(this["webpackJsonpsalsa-ts"]=this["webpackJsonpsalsa-ts"]||[]).push([[0],{132:function(e,t,n){},133:function(e,t,n){"use strict";n.r(t);var i=n(0),s=n.n(i),a=n(7),c=n.n(a),r=(n(99),n(8)),o=n(9),l=n.n(o),u=n(18),d=n(136),j=n(16),b=n(31),x=n(14),h=n(21),f=Object(h.b)({name:"cursor",initialState:{position:[0,0]},reducers:{setPosition:function(e,t){e.position=t.payload}}}),O=f.actions.setPosition,p=f.reducer,v=n(12),g=n.n(v),y=n(47),m=n.n(y),w=n(48),S=n.n(w),F=n(1);S()(g.a),n(107)(g.a);var P=Object(i.memo)((function(e){var t,n,s=Object(i.useRef)(null),a=null===(t=s.current)||void 0===t?void 0:t.chart,c="baseline"===e.cursorDragMode||"gaussian"===e.cursorDragMode,o=e.setBaselinePoints,l=e.gaussianGuess,u=e.setGaussianGuess,d=e.showSubtraction,j=e.isBaselineFitted,h=e.gaussianData,f=Object(i.useState)([]),p=Object(r.a)(f,2),v=p[0],y=p[1];"baseline"===e.cursorDragMode?n=function(t){if(console.log(t),console.log(a),console.log("chart option",null===a||void 0===a?void 0:a.options),(null===a||void 0===a?void 0:a.series)&&a.series.forEach((function(e){!0===e.options.allowPointSelect&&(null===e||void 0===e||e.points.forEach((function(e){e.x>=t.xAxis[0].min&&e.x<=t.xAxis[0].max&&e.y>=t.yAxis[0].min&&e.y<=t.yAxis[0].max&&e.select(!0,!0)})))})),"baseline"===e.cursorDragMode){var n=null===a||void 0===a?void 0:a.getSelectedPoints().map((function(e){return[e.x,e.y]}));o(n)}return!1}:"gaussian"===e.cursorDragMode&&(n=function(t){var n=t.xAxis[0].min,i=t.xAxis[0].max,s=t.yAxis[0].min,c=t.yAxis[0].max,r=(null===a||void 0===a?void 0:a.xAxis[0].toPixels(n,!1))||0,o=(null===a||void 0===a?void 0:a.xAxis[0].toPixels(i,!1))||0,d=(null===a||void 0===a?void 0:a.yAxis[0].toPixels(s,!1))||0,j=(null===a||void 0===a?void 0:a.yAxis[0].toPixels(c,!1))||0,x=o-r,h=d-j;console.log("rect params",r,j,x,h);var f=null===a||void 0===a?void 0:a.renderer.rect(r,j,x,h,2).attr({"stroke-width":2,stroke:"red",fill:"black","fill-opacity":.1,zIndex:3}).add();return"gaussian"===e.cursorDragMode&&(u([].concat(Object(b.a)(l),[[n,i,s,c]])),y([].concat(Object(b.a)(v),[f]))),!1});var w,S=e.fileName,P=e.dataSource,k=e.unit;w="freq-k"===k?"kHz":"freq-m"===k?"MHz":"freq-g"===k?"GHz":"chan"===k?"Channel":"vel"===k?"Velocity (km/s)":"Hz";var A={chart:{zoomType:"x"},tooltip:{enabled:!0},plotOptions:{series:{enableMouseTracking:!0,tooltip:{followPointer:!1}}}},B=[];if(P){var G=P.axisdata(1,k).toJs(),C=P.rawdata.toJs()[0][0],q=P.header.toJs(),z=[].slice.call(G);B=z.map((function(e,t){return[e,C[t]]}));var M=z.map((function(e,t){return[e,0]}));if(!0===j){var D=P.baseline.toJs();M.forEach((function(e,t){e[1]=D[t]}))}if(!0===d){var T=B.map((function(e,t){return[e[0],e[1]-M[t][1]]}));A.series=[{name:"Observation - Baseline",type:"scatter",data:T,findNearestPointBy:"xy"}]}else A.series=[{name:"Observation",type:"scatter",lineWidth:2,data:B,allowPointSelect:c,findNearestPointBy:"xy"}],!0===j&&A.series.push({name:"Baseline fitting",type:"line",data:M,allowPointSelect:!1,colorIndex:3}),console.log("series",A.series);if(h){var E=z.map((function(e,t){return[e,0]}));E.forEach((function(e,t){e[1]=h[t]})),A.series.push({name:"Gaussian",type:"line",data:E,findNearestPointBy:"xy",colorIndex:5})}var H="".concat(q.get("CTYPE2"),": ").concat(q.get("CRVAL2"),", ").concat(q.get("CTYPE3"),": ").concat(q.get("CRVAL3"));A.title={text:S},A.subtitle={text:H};var N={title:{text:w}},V={title:{text:q.get("BUNIT")}};A.xAxis=N,A.yAxis=V}!0===c&&A.chart?(A.chart.zoomType="xy",A.chart.renderTo=null===a||void 0===a?void 0:a.container,A.chart.events={selection:n,click:function(){var e=null===a||void 0===a?void 0:a.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)})),o([])}}):A.chart&&(A.chart.zoomType="x",A.chart.events={selection:void 0,click:void 0,render:void 0}),console.log("options",A);var R=Object(x.b)();return Object(F.jsx)(F.Fragment,{children:Object(F.jsx)(m.a,{highcharts:g.a,options:A,ref:s,containerProps:{onMouseMove:function(e){var t=function(e){var t=0,n=0;if(a){var i=a.pointer.normalize(e),s=i.chartX-a.plotLeft,c=i.chartY-a.plotTop;s>=0&&c>=0&&s<=a.chartWidth&&c<=a.chartHeight&&(t=a.xAxis[0].toValue(s,!0),n=a.yAxis[0].toValue(c,!0))}return{xPos:t,yPos:n}}(e),n=t.xPos,i=t.yPos;R(O([n,i]))}}})})})),k=function(e){var t=e.unit,n=e.setUnit;return Object(F.jsx)(F.Fragment,{children:Object(F.jsx)(d.d,{label:"x-axis unit:",inline:!0,children:Object(F.jsxs)(d.e,{value:t,minimal:!0,onChange:function(e){n(e.target.value)},children:[Object(F.jsx)("option",{value:"freq",children:"Frequency (Hz)"}),Object(F.jsx)("option",{value:"freq-k",children:"Frequency (kHz)"}),Object(F.jsx)("option",{value:"freq-m",children:"Frequency (MHz)"}),Object(F.jsx)("option",{value:"freq-g",children:"Frequency (GHz)"}),Object(F.jsx)("option",{value:"chan",children:"Channel"}),Object(F.jsx)("option",{value:"vel",children:"Velocity (km/s)"})]})})})},A=function(e){var t=e.clearBaseline,n=e.getBaselineFit,i=e.showSubtraction,s=e.setShowSubtraction;return Object(F.jsxs)("div",{children:[Object(F.jsx)(d.p,{checked:i,label:"Show only subtraction",onChange:function(){s(!i)}}),Object(F.jsx)(d.a,{text:"Clear",onClick:function(){t()}}),Object(F.jsx)(d.a,{text:"Fit Baseline",onClick:function(){n()}})]})},B=function(e){var t=e.nGaussian,n=e.setNGaussian,s=e.getGaussianFit,a=Object(i.useState)(!1),c=Object(r.a)(a,2),o=c[0],l=c[1];return Object(F.jsxs)("div",{children:[Object(F.jsx)(d.p,{checked:o,label:"Fit Gaussian",onChange:function(){l(!o),s(o?0:t)}}),Object(F.jsx)(d.m,{value:t,min:1,onValueChange:function(e){n(e),o&&s(e)}})]})},G=function(e){var t=e.unit,n=e.setUnit,s=e.getBaselineFit,a=e.showSubtraction,c=e.setShowSubtraction,o=Object(i.useState)(1),l=Object(r.a)(o,2),u=l[0],j=l[1],b=e.getGaussianFit,x=e.clearBaseline;return Object(F.jsx)("div",{style:e.style,children:Object(F.jsxs)(d.r,{id:"viewerpanels",vertical:!0,children:[Object(F.jsx)(d.q,{id:"generalpanel",title:"General",panel:Object(F.jsx)(k,{unit:t,setUnit:n})}),Object(F.jsx)(d.q,{id:"baselinepanel",title:"Baseline",panel:Object(F.jsx)(A,{clearBaseline:x,getBaselineFit:s,showSubtraction:a,setShowSubtraction:c})}),Object(F.jsx)(d.q,{id:"gaussianpanel",title:"Gaussian",panel:Object(F.jsx)(B,{nGaussian:u,setNGaussian:j,getGaussianFit:b})})]})})},C=n.p+"static/media/salsasource.47396e84.py",q=Object(h.a)({reducer:{cursor:p}}),z=(n(132),function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"});case 2:return t=e.sent,e.next=5,t.loadPackage(["astropy","scipy"]);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),M=function(){var e=Object(u.a)(l.a.mark((function e(t,n){var i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.runPythonAsync(n);case 2:return i=t.globals.get("salsa"),console.log("globals",i),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var D=function(e){var t=e.isBaselineFitted,n=e.showSubtraction,i=Object(x.c)((function(e){return e.cursor.position}));return Object(F.jsxs)("div",{style:{textAlign:"left"},children:[Object(F.jsxs)(d.h,{children:["Position: (",i[0],", ",i[1],")"]}),Object(F.jsx)(d.d,{label:"Drag Action:",inline:!0,children:Object(F.jsxs)(d.o,{onChange:function(t){console.log(t),e.onChange(t.target.defaultValue)},selectedValue:e.cursorDragMode,inline:!0,children:[Object(F.jsx)(d.n,{label:"Zoom",value:"zoom"}),Object(F.jsx)(d.n,{label:"Baseline",value:"baseline"}),Object(F.jsx)(d.n,{label:"Gaussian",value:"gaussian",disabled:!t||!n})]})})]})},T=function(e){var t=e.baselinePoints;return Object(F.jsx)(d.b,{children:Object(F.jsxs)(d.f,{striped:!0,condensed:!0,interactive:!0,children:[Object(F.jsx)("thead",{style:{display:"table"},children:Object(F.jsxs)("tr",{children:[Object(F.jsx)("th",{style:{width:140},children:"Selected Points"}),Object(F.jsx)("th",{style:{width:140},children:"X coordinate"}),Object(F.jsx)("th",{style:{width:140},children:"Y coordinate"})]})}),Object(F.jsx)("tbody",{style:{display:"block",overflow:"auto",height:150},children:t.map((function(e,t){return Object(F.jsxs)("tr",{style:{display:"table"},onClick:function(){console.log("click table")},children:[Object(F.jsx)("td",{style:{width:140,textAlign:"left"},children:t}),Object(F.jsx)("td",{style:{width:140,textAlign:"left"},children:e[0].toFixed(6)}),Object(F.jsx)("td",{style:{width:140,textAlign:"left"},children:e[1].toFixed(6)})]},e[0])}))})]})})},E=function(e){var t=e.gaussianGuess;return Object(F.jsx)(F.Fragment,{children:Object(F.jsx)(d.b,{children:Object(F.jsxs)(d.f,{striped:!0,condensed:!0,interactive:!0,children:[Object(F.jsx)("thead",{style:{display:"table"},children:Object(F.jsxs)("tr",{children:[Object(F.jsx)("th",{style:{width:140},children:"Selected Range"}),Object(F.jsx)("th",{style:{width:200},children:"X range"}),Object(F.jsx)("th",{style:{width:200},children:"Y range"})]})}),Object(F.jsx)("tbody",{style:{display:"block",overflow:"auto",height:150},children:t.map((function(e,t){return Object(F.jsxs)("tr",{style:{display:"table"},onClick:function(){console.log("click table")},children:[Object(F.jsx)("td",{style:{width:140,textAlign:"left"},children:t}),Object(F.jsxs)("td",{style:{width:200,textAlign:"left"},children:["(",e[0].toFixed(6),", ",e[1].toFixed(6),")"]}),Object(F.jsxs)("td",{style:{width:200,textAlign:"left"},children:["(",e[2].toFixed(6),", ",e[3].toFixed(6),")"]})]},e[0])}))})]})})})},H=function(){var e=Object(i.useRef)(null),t=Object(i.useState)(!1),n=Object(r.a)(t,2),s=n[0],a=n[1],c=Object(i.useState)(""),o=Object(r.a)(c,2),b=o[0],h=o[1],f=Object(i.useState)("freq"),O=Object(r.a)(f,2),p=O[0],v=O[1],g=Object(i.useState)("zoom"),y=Object(r.a)(g,2),m=y[0],w=y[1],S=Object(i.useState)([]),k=Object(r.a)(S,2),A=k[0],B=k[1],H=Object(i.useState)(!1),N=Object(r.a)(H,2),V=N[0],R=N[1],I=Object(i.useState)(!1),J=Object(r.a)(I,2),L=J[0],U=J[1],Y=Object(i.useState)([]),X=Object(r.a)(Y,2),_=X[0],W=X[1],Z=Object(i.useState)([]),K=Object(r.a)(Z,2),Q=K[0],$=K[1];Object(i.useEffect)((function(){function t(){return(t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s){t.next=7;break}return t.next=3,z();case 3:e.current=t.sent,a(!0),t.next=8;break;case 7:console.log("no duplicate reload to avoid pyodide error");case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}));var ee=Object(i.useState)(),te=Object(r.a)(ee,2),ne=te[0],ie=te[1],se=function(){var t=Object(u.a)(l.a.mark((function t(n){var i,s;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(C);case 2:return t.next=4,t.sent.text();case 4:return i=t.sent,t.next=7,M(e.current,i);case 7:s=t.sent,h(n.name),ie(s);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(F.jsx)(x.a,{store:q,children:Object(F.jsxs)("div",{className:"App",children:[Object(F.jsx)(d.i,{children:Object(F.jsxs)(d.k,{align:j.a.LEFT,children:[Object(F.jsx)(d.l,{children:"SalsaTS"}),Object(F.jsx)(d.j,{}),Object(F.jsx)(d.a,{disabled:!s,children:Object(F.jsxs)("label",{htmlFor:"input",children:[Object(F.jsx)("input",{type:"file",id:"input",hidden:!0,onChange:function(e){!function(e){if(e){console.log("processing file:",e);var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){window.jsarray=new Float32Array(t.result),se(e)},t.readAsArrayBuffer(e)}}(e.target.files[0])}}),Object(F.jsx)(d.g,{icon:"document"})," Upload"]})})]})}),Object(F.jsx)(P,{fileName:b,dataSource:ne,unit:p,cursorDragMode:m,gaussianGuess:_,isBaselineFitted:V,setBaselinePoints:B,setGaussianGuess:W,showSubtraction:L,gaussianData:Q}),Object(F.jsxs)("div",{style:{display:"flex"},children:[Object(F.jsx)(G,{style:{flex:1},unit:p,setUnit:v,clearBaseline:function(){B([]),null===ne||void 0===ne||ne.fit_baseline([],[],p),R(!1)},getBaselineFit:function(){var e=A,t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]}));t.length&&n.length?(null===ne||void 0===ne||ne.fit_baseline(t,n,p),R(!0)):(ne.baseline=[],R(!1))},showSubtraction:L,setShowSubtraction:U,getGaussianFit:function(e){var t=null===ne||void 0===ne?void 0:ne.fit_gaussian(p,e,_).toJs();$(t)}}),Object(F.jsx)(d.c,{}),Object(F.jsx)("div",{style:{flex:1},children:Object(F.jsxs)(d.r,{children:[Object(F.jsx)(d.q,{id:"cursorpanel",title:"Cursor Information",panel:Object(F.jsx)(D,{cursorDragMode:m,isBaselineFitted:V,showSubtraction:L,onChange:w})}),Object(F.jsx)(d.q,{id:"baselinepoints",title:"Selected Baseline Points",panel:Object(F.jsx)(T,{baselinePoints:A})}),Object(F.jsx)(d.q,{id:"gaussianranges",title:"Selected Gaussian Ranges",panel:Object(F.jsx)(E,{gaussianGuess:_})})]})})]})]})})},N=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,137)).then((function(t){var n=t.getCLS,i=t.getFID,s=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),i(e),s(e),a(e),c(e)}))};c.a.render(Object(F.jsx)(s.a.StrictMode,{children:Object(F.jsx)(H,{})}),document.getElementById("root")),N()},99:function(e,t,n){}},[[133,1,2]]]);
//# sourceMappingURL=main.555438df.chunk.js.map