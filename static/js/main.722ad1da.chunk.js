(this["webpackJsonpsalsa-ts"]=this["webpackJsonpsalsa-ts"]||[]).push([[0],{133:function(e,t,n){},159:function(e,t,n){},160:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),c=n(13),o=n.n(c),s=(n(133),n(21)),r=n(24),l=n.n(r),u=n(41),d=n(161),j=n(36),b=n(40),f=n(175),x=n(81),v=n(42),O=n(15),p=n(25),h=Object(p.b)({name:"cursor",initialState:{position:[0,0],drag:"zoom"},reducers:{setPosition:function(e,t){e.position=t.payload},setDrag:function(e,t){e.drag=t.payload}}}),m=h.actions,g=m.setPosition,y=m.setDrag,P=h.reducer,T=Object(p.b)({name:"baseline",initialState:{dataPoints:[],fitValues:[],subtraction:!1},reducers:{setDataPoints:function(e,t){e.dataPoints=t.payload},setFitValues:function(e,t){e.fitValues=t.payload},setSubtraction:function(e,t){e.subtraction=t.payload}}}),k=T.actions,F=k.setDataPoints,w=k.setFitValues,C=k.setSubtraction,S=T.reducer,A=Object(p.b)({name:"gaussian",initialState:{order:0,isFitting:!1,guess:[],params:[],fit:[]},reducers:{setOrder:function(e,t){e.order=t.payload},setIsFitting:function(e,t){e.isFitting=t.payload},setGaussianGuess:function(e,t){e.guess=t.payload},setGaussianFit:function(e,t){e.fit=t.payload}}}),q=A.actions,E=q.setOrder,z=q.setIsFitting,L=q.setGaussianGuess,R=q.setGaussianFit,G=A.reducer,_=n(22),V=n.n(_),I=n(75),N=n.n(I),H=n(76),B=n.n(H),J=n(77),D=n.n(J),U=n(16),M=n(2),Y=n(82),W=n(53),X=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return 0;var n=e.toExponential().split("e").map((function(e){return Number(e)})),i=Object(s.a)(n,2),a=i[0],c=i[1];return 0===c?"".concat(a.toFixed(t)):"".concat(a.toFixed(t),"x10^").concat(c)},K=n(6);B()(V.a),D()(V.a),n(141)(V.a),n(142)(V.a);var Q=Object(i.memo)((function(e){var t,n,a=Object(O.b)(),c=Object(O.c)((function(e){return e.cursor.drag})),o=Object(O.c)((function(e){return e.baseline.fitValues})),r=Object(O.c)((function(e){return e.baseline.subtraction})),l=o.length>0,u=Object(O.c)((function(e){return e.gaussian.order})),d=Object(O.c)((function(e){return e.gaussian.isFitting})),j=Object(O.c)((function(e){return e.gaussian.guess})),b=Object(O.c)((function(e){return e.gaussian.fit})),f=Object(i.useRef)(null),x=null===(t=f.current)||void 0===t?void 0:t.chart,p=e.fileName,h=e.dataSource,m=e.unit,y=e.setUnit;n="freq-k"===m?"kHz":"freq-m"===m?"MHz":"freq-g"===m?"GHz":"chan"===m?"Channel":"vel"===m?"Velocity (km/s)":"Hz";var P={chart:{zoomType:"x"},tooltip:{enabled:!0},plotOptions:{series:{enableMouseTracking:!0,tooltip:{followPointer:!1},events:{click:function(e){a(L(j.filter((function(t,n){return n!==e.point.series.index-(3-Number(r))}))))}}}}},T=[];if(h){var k=h.axisdata(1,m).toJs(),w=h.rawdata.toJs()[0][0],C=h.header.toJs(),S=[].slice.call(k);T=S.map((function(e,t){return[e,w[t]]}));var A=S.map((function(e,t){return[e,0]}));if(!0===l&&A.forEach((function(e,t){e[1]=o[t]})),!0===r){var q=T.map((function(e,t){return[e[0],e[1]-A[t][1]]}));P.series=[{name:"Observation - Baseline",type:"scatter",data:q,findNearestPointBy:"xy"}]}else P.series=[{name:"Observation",type:"scatter",lineWidth:2,data:T,allowPointSelect:"zoom"!==c,findNearestPointBy:"xy"}],!0===l&&P.series.push({name:"Baseline fitting",type:"line",data:A,allowPointSelect:!1,colorIndex:3}),console.log("series",P.series);if(b){var E=S.map((function(e,t){return[e,0]}));E.forEach((function(e,t){e[1]=b[t]})),P.series.push({name:"Gaussian",type:"line",data:E,findNearestPointBy:"xy",colorIndex:5})}if(j){var z=j.map((function(e,t){var n=Object(s.a)(e,4),i=n[0],a=n[1],c=n[2],o=n[3],r=null===h||void 0===h?void 0:h.convertfreq(i,m),l=null===h||void 0===h?void 0:h.convertfreq(a,m);return{name:"Peak ".concat(t+1),type:"polygon",data:[[r,c],[l,c],[l,o],[r,o]],color:"green",opacity:.5}}));z&&(P.series=[].concat(Object(v.a)(P.series),Object(v.a)(z)))}var G="".concat(C.get("CTYPE2"),": ").concat(X(C.get("CRVAL2")),", ").concat(C.get("CTYPE3"),": ").concat(X(C.get("CRVAL3")));P.title={text:p},P.subtitle={text:G};var _={title:{text:n}},I={title:{text:C.get("BUNIT")}};P.xAxis=_,P.yAxis=I}"baseline"===c&&P.chart?(P.chart.zoomType="xy",P.chart.renderTo=null===x||void 0===x?void 0:x.container,P.chart.events={selection:function(e){console.log(e),console.log(x),console.log("chart option",null===x||void 0===x?void 0:x.options),(null===x||void 0===x?void 0:x.series)&&x.series.forEach((function(t){!0===t.options.allowPointSelect&&(null===t||void 0===t||t.points.forEach((function(t){t.x>=e.xAxis[0].min&&t.x<=e.xAxis[0].max&&t.y>=e.yAxis[0].min&&t.y<=e.yAxis[0].max&&t.select(!0,!0)})))}));var t=(null===x||void 0===x?void 0:x.getSelectedPoints().map((function(e){return[e.x||0,e.y||0]})))||[];return a(F(t)),!1},click:function(){var e=null===x||void 0===x?void 0:x.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)})),a(F([]))}}):"gaussian"===c&&P.chart?(P.chart.zoomType="xy",P.chart.renderTo=null===x||void 0===x?void 0:x.container,P.chart.events={selection:function(e){var t=[null===h||void 0===h?void 0:h.convert2freq(e.xAxis[0].min,m),null===h||void 0===h?void 0:h.convert2freq(e.xAxis[0].max,m),e.yAxis[0].min,e.yAxis[0].max];return a(L([].concat(Object(v.a)(j),[t]))),d&&function(e,t){var n=t.map((function(e){var t=Object(s.a)(e,4),n=t[0],i=t[1],a=t[2],c=t[3],o=null===h||void 0===h?void 0:h.convertfreq(n,m),r=null===h||void 0===h?void 0:h.convertfreq(i,m);return[o<=r?o:r,o<=r?r:o,a,c]})),i=null===h||void 0===h?void 0:h.fit_gaussian(m,e,n).toJs(),c=[].slice.call(i);a(R(c))}(u,[].concat(Object(v.a)(j),[t])),!1}}):P.chart&&(P.chart.zoomType="x",P.chart.events={selection:void 0,click:void 0,render:void 0}),console.log("options",P);return Object(K.jsxs)("div",{children:[Object(K.jsx)(N.a,{highcharts:V.a,options:P,ref:f,containerProps:{onMouseMove:function(e){var t=function(e){var t=0,n=0;if(x){var i=x.pointer.normalize(e),a=i.chartX-x.plotLeft,c=i.chartY-x.plotTop;a>=0&&c>=0&&a<=x.chartWidth&&c<=x.chartHeight&&(t=x.xAxis[0].toValue(a,!0),n=x.yAxis[0].toValue(c,!0))}return{xPos:t,yPos:n}}(e),n=t.xPos,i=t.yPos;a(g([n,i]))}}}),Object(K.jsx)(Z,{unit:m,setUnit:y,dataSource:h,unSelectAllPoints:function(){var e=null===x||void 0===x?void 0:x.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)}))}})]})})),Z=function(e){var t=Object(O.b)(),n=Object(O.c)((function(e){return e.cursor.drag})),i=Object(O.c)((function(e){return e.baseline.dataPoints})),a=Object(O.c)((function(e){return e.baseline.fitValues})),c=Object(O.c)((function(e){return e.baseline.subtraction})),o=a.length>0,r=i.map((function(e){return e[0]})),l=i.map((function(e){return e[1]})),u=Object(O.c)((function(e){return e.gaussian.order})),j=Object(O.c)((function(e){return e.gaussian.isFitting})),b=Object(O.c)((function(e){return e.gaussian.guess})),f=e.dataSource,x=e.unit,v=e.setUnit,p=e.unSelectAllPoints,h=function(e,n){var i=null===f||void 0===f?void 0:f.fit_baseline(e,n,x).toJs(),a=[].slice.call(i);t(w(a))},m=function(e){var n=b.map((function(e){var t=Object(s.a)(e,4),n=t[0],i=t[1],a=t[2],c=t[3],o=null===f||void 0===f?void 0:f.convertfreq(n,x),r=null===f||void 0===f?void 0:f.convertfreq(i,x);return[o<=r?o:r,o<=r?r:o,a,c]})),i=null===f||void 0===f?void 0:f.fit_gaussian(x,e,n).toJs(),a=[].slice.call(i);t(R(a))};return Object(K.jsxs)("div",{style:{display:"flex"},children:[Object(K.jsxs)(d.c,{children:[Object(K.jsx)(Y.a,{content:"Cursor action: drag to zoom",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"zoom-in",small:!0,active:"zoom"===n,onClick:function(){t(y("zoom"))}})}),Object(K.jsx)(Y.a,{content:"Cursor action: select baseline points",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"widget-button",small:!0,active:"baseline"===n,disabled:c,onClick:function(){t(y("baseline"))}})}),Object(K.jsx)(Y.a,{content:"Cursor action: select gaussian peak ranges",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"widget",small:!0,active:"gaussian"===n,disabled:!o||!c,onClick:function(){t(y("gaussian"))}})})]}),Object(K.jsx)(d.f,{}),Object(K.jsx)(Y.a,{content:"Subtraction baseline",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"bring-data",small:!0,active:c,onClick:function(){t(C(!c)),t(y("zoom"))}})}),Object(K.jsx)(Y.a,{content:"Fit baseline",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"regression-chart",small:!0,disabled:!i.length,onClick:function(){h(r,l)}})}),Object(K.jsx)(Y.a,{content:"Remove all baseline data",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){p(),t(F([])),h([],[])}})}),Object(K.jsx)(d.f,{}),Object(K.jsx)(Y.a,{className:M.a.TOOLTIP_INDICATOR,content:"Fit Gaussian",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"timeline-bar-chart",small:!0,active:j,disabled:!i.length||!c,onClick:function(){j?t(R([])):m(u),t(z(!j))}})}),Object(K.jsx)(W.a,{content:Object(K.jsx)(d.q,{style:{width:30},value:u,min:0,onValueChange:function(e){t(E(e)),j&&m(e)}}),children:Object(K.jsx)(Y.a,{content:"Number of Gaussian peaks",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{text:u,small:!0})})}),Object(K.jsx)(Y.a,{content:"Remove all gaussian data",position:U.a.TOP_LEFT,minimal:!0,children:Object(K.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){t(z(!1)),t(L([])),t(R([]))}})}),Object(K.jsx)(d.g,{style:{marginLeft:"auto",height:10},label:"x-axis unit:",inline:!0,children:Object(K.jsxs)(d.h,{value:x,minimal:!0,onChange:function(e){v(e.target.value)},children:[Object(K.jsx)("option",{value:"freq",children:"Frequency (Hz)"}),Object(K.jsx)("option",{value:"freq-k",children:"Frequency (kHz)"}),Object(K.jsx)("option",{value:"freq-m",children:"Frequency (MHz)"}),Object(K.jsx)("option",{value:"freq-g",children:"Frequency (GHz)"}),Object(K.jsx)("option",{value:"chan",children:"Channel"}),Object(K.jsx)("option",{value:"vel",children:"Velocity (km/s)"})]})})]})},$=Q,ee=n.p+"static/media/salsasource.1eae1293.py",te=(n(159),function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"});case 2:return t=e.sent,e.next=5,t.loadPackage(["astropy","scipy"]);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),ne=function(){var e=Object(u.a)(l.a.mark((function e(t,n){var i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.runPythonAsync(n);case 2:return i=t.globals.get("salsa"),console.log("globals",i),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var ie=function(e){var t=Object(O.c)((function(e){return e.cursor.position}));return Object(K.jsx)("div",{style:{textAlign:"left"},children:Object(K.jsxs)(d.l,{children:["Position: (",X(t[0]),", ",X(t[1]),")"]})})},ae=function(e){var t=Object(O.c)((function(e){return e.baseline.dataPoints}));return Object(K.jsx)(d.d,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(K.jsxs)(f.a,{numRows:t.length,enableGhostCells:!0,children:[Object(K.jsx)(x.a,{name:"X coordinate",cellRenderer:function(e){return Object(K.jsx)(b.a,{children:"".concat(t[e]?X(t[e][0]):0)})}}),Object(K.jsx)(x.a,{name:"Y coordinate",cellRenderer:function(e){return Object(K.jsx)(b.a,{children:"".concat(t[e]?X(t[e][1]):0)})}})]})})},ce=function(e){var t=Object(O.c)((function(e){return e.gaussian.guess}));return Object(K.jsx)(d.d,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(K.jsxs)(f.a,{numRows:t.length,enableGhostCells:!0,columnWidths:[300,200],children:[Object(K.jsx)(x.a,{name:"X range",cellRenderer:function(e){return Object(K.jsxs)(b.a,{children:["(","".concat(t[e]?X(t[e][0]):0),","," ".concat(t[e]?X(t[e][1]):0),")"]})}}),Object(K.jsx)(x.a,{name:"Y range",cellRenderer:function(e){return Object(K.jsxs)(b.a,{children:["(","".concat(t[e]?X(t[e][2]):0),","," ".concat(t[e]?X(t[e][3]):0),")"]})}})]})})},oe=function(){Object(O.b)();var e=Object(i.useRef)(null),t=Object(i.useState)(!1),n=Object(s.a)(t,2),a=n[0],c=n[1],o=Object(i.useState)(""),r=Object(s.a)(o,2),b=r[0],f=r[1],x=Object(i.useState)("freq"),v=Object(s.a)(x,2),p=v[0],h=v[1],m=Object(i.useState)(),g=Object(s.a)(m,2),y=g[0],P=g[1];Object(i.useEffect)((function(){function t(){return(t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=7;break}return t.next=3,te();case 3:e.current=t.sent,c(!0),t.next=8;break;case 7:console.log("no duplicate reload to avoid pyodide error");case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}));var T=function(){var t=Object(u.a)(l.a.mark((function t(n){var i,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(ee);case 2:return t.next=4,t.sent.text();case 4:return i=t.sent,t.next=7,ne(e.current,i);case 7:a=t.sent,f(n.name),P(a);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(K.jsxs)("div",{className:"App",children:[Object(K.jsxs)(d.m,{children:[Object(K.jsxs)(d.o,{align:j.a.LEFT,children:[Object(K.jsx)(d.p,{children:"SalsaTS"}),Object(K.jsx)(d.n,{}),Object(K.jsx)(d.b,{disabled:!a,minimal:!0,children:Object(K.jsxs)("label",{htmlFor:"input",children:[Object(K.jsx)("input",{type:"file",id:"input",hidden:!0,onChange:function(e){!function(e){if(e){console.log("processing file:",e);var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){window.jsarray=new Float32Array(t.result),T(e)},t.readAsArrayBuffer(e)}}(e.target.files[0])}}),Object(K.jsx)(d.j,{icon:"document"})," Upload"]})})]}),Object(K.jsx)(d.o,{align:j.a.RIGHT,children:Object(K.jsx)(d.b,{icon:"help",text:"Help",minimal:!0,onClick:function(e){e.preventDefault(),window.open("https://github.com/appolloford/salsa-ts/wiki","_blank","noopener,noreferrer")}})})]}),Object(K.jsx)($,{fileName:b,dataSource:y,unit:p,setUnit:h}),Object(K.jsx)("div",{style:{display:"flex"},children:Object(K.jsx)("div",{style:{flex:1},children:Object(K.jsxs)(d.v,{children:[Object(K.jsx)(d.u,{id:"cursorpanel",title:"Cursor Information",panel:Object(K.jsx)(ie,{})}),Object(K.jsx)(d.u,{id:"baselinepoints",title:"Selected Baseline Points",panel:Object(K.jsx)(ae,{})}),Object(K.jsx)(d.u,{id:"gaussianranges",title:"Selected Gaussian Ranges",panel:Object(K.jsx)(ce,{})})]})})})]})},se=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,176)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),i(e),a(e),c(e),o(e)}))},re=Object(p.a)({reducer:{cursor:P,baseline:S,gaussian:G}});o.a.render(Object(K.jsx)(a.a.StrictMode,{children:Object(K.jsx)(O.a,{store:re,children:Object(K.jsx)(oe,{})})}),document.getElementById("root")),se()}},[[160,1,2]]]);
//# sourceMappingURL=main.722ad1da.chunk.js.map