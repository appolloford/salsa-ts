(this["webpackJsonpsalsa-ts"]=this["webpackJsonpsalsa-ts"]||[]).push([[0],{132:function(e,t,n){},157:function(e,t,n){},158:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),c=n(13),o=n.n(c),s=(n(132),n(21)),r=n(23),l=n.n(r),u=n(41),d=n(159),j=n(36),b=n(40),f=n(173),x=n(80),O=n(53),p=n(15),h=n(24),v=Object(h.b)({name:"cursor",initialState:{position:[0,0],drag:"zoom"},reducers:{setPosition:function(e,t){e.position=t.payload},setDrag:function(e,t){e.drag=t.payload}}}),g=v.actions,m=g.setPosition,y=g.setDrag,P=v.reducer,k=Object(h.b)({name:"baseline",initialState:{dataPoints:[],fitValues:[],subtraction:!1},reducers:{setDataPoints:function(e,t){e.dataPoints=t.payload},setFitValues:function(e,t){e.fitValues=t.payload},setSubtraction:function(e,t){e.subtraction=t.payload}}}),w=k.actions,F=w.setDataPoints,T=w.setFitValues,C=w.setSubtraction,S=k.reducer,A=Object(h.b)({name:"gaussian",initialState:{order:0,isFitting:!1,guess:[],params:[],fit:[]},reducers:{setOrder:function(e,t){e.order=t.payload},setIsFitting:function(e,t){e.isFitting=t.payload},setGaussianGuess:function(e,t){e.guess=t.payload},setGaussianFit:function(e,t){e.fit=t.payload}}}),E=A.actions,z=E.setOrder,L=E.setIsFitting,R=E.setGaussianGuess,G=E.setGaussianFit,_=A.reducer,q=n(29),I=n.n(q),V=n(75),H=n.n(V),N=n(76),B=n.n(N),J=n(16),D=n(2),U=n(81),M=n(52),Y=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(!e)return 0;var n=e.toExponential().split("e").map((function(e){return Number(e)})),i=Object(s.a)(n,2),a=i[0],c=i[1];return 0===c?"".concat(a.toFixed(t)):"".concat(a.toFixed(t),"x10^").concat(c)},W=n(6);B()(I.a),n(140)(I.a);var X=Object(i.memo)((function(e){var t,n=Object(p.b)(),a=Object(p.c)((function(e){return e.cursor.drag})),c="baseline"===a||"gaussian"===a,o=Object(p.c)((function(e){return e.baseline.fitValues})),r=Object(p.c)((function(e){return e.baseline.subtraction})),l=o.length>0,u=Object(p.c)((function(e){return e.gaussian.order})),d=Object(p.c)((function(e){return e.gaussian.isFitting})),j=Object(p.c)((function(e){return e.gaussian.guess})),b=Object(p.c)((function(e){return e.gaussian.fit})),f=Object(i.useRef)(j);Object(i.useEffect)((function(){f.current=j}),[j]);var x,h,v=Object(i.useRef)(null),g=null===(t=v.current)||void 0===t?void 0:t.chart,y=e.fileName,P=e.dataSource,k=e.unit,w=e.setUnit;"baseline"===a?x=function(e){console.log(e),console.log(g),console.log("chart option",null===g||void 0===g?void 0:g.options),(null===g||void 0===g?void 0:g.series)&&g.series.forEach((function(t){!0===t.options.allowPointSelect&&(null===t||void 0===t||t.points.forEach((function(t){t.x>=e.xAxis[0].min&&t.x<=e.xAxis[0].max&&t.y>=e.yAxis[0].min&&t.y<=e.yAxis[0].max&&t.select(!0,!0)})))}));var t=(null===g||void 0===g?void 0:g.getSelectedPoints().map((function(e){return[e.x||0,e.y||0]})))||[];return n(F(t)),!1}:"gaussian"===a&&(x=function(e){var t=[e.xAxis[0].min,e.xAxis[0].max,e.yAxis[0].min,e.yAxis[0].max];return n(R([].concat(Object(O.a)(j),[t]))),d&&function(e,t){var i=null===P||void 0===P?void 0:P.fit_gaussian(k,e,t).toJs(),a=[].slice.call(i);n(G(a))}(u,[].concat(Object(O.a)(j),[t])),function(e){var t=Object(s.a)(e,4),i=t[0],a=t[1],c=t[2],o=t[3],r=(null===g||void 0===g?void 0:g.xAxis[0].toPixels(i,!1))||0,l=(null===g||void 0===g?void 0:g.xAxis[0].toPixels(a,!1))||0,u=(null===g||void 0===g?void 0:g.yAxis[0].toPixels(c,!1))||0,d=(null===g||void 0===g?void 0:g.yAxis[0].toPixels(o,!1))||0,j=l-r,b=u-d;console.log("rect params",r,d,j,b);var x=null===g||void 0===g?void 0:g.renderer.rect(r,d,j,b,2).attr({"stroke-width":2,stroke:"red",fill:"black","fill-opacity":.1,zIndex:3}).on("click",(function(){var t=f.current.filter((function(t){return t!==e}));n(R(t)),null===x||void 0===x||x.destroy()})).add()}(t),!1}),h="freq-k"===k?"kHz":"freq-m"===k?"MHz":"freq-g"===k?"GHz":"chan"===k?"Channel":"vel"===k?"Velocity (km/s)":"Hz";var T={chart:{zoomType:"x"},tooltip:{enabled:!0},plotOptions:{series:{enableMouseTracking:!0,tooltip:{followPointer:!1}}}},C=[];if(P){var S=P.axisdata(1,k).toJs(),A=P.rawdata.toJs()[0][0],E=P.header.toJs(),z=[].slice.call(S);C=z.map((function(e,t){return[e,A[t]]}));var L=z.map((function(e,t){return[e,0]}));if(!0===l&&L.forEach((function(e,t){e[1]=o[t]})),!0===r){var _=C.map((function(e,t){return[e[0],e[1]-L[t][1]]}));T.series=[{name:"Observation - Baseline",type:"scatter",data:_,findNearestPointBy:"xy"}]}else T.series=[{name:"Observation",type:"scatter",lineWidth:2,data:C,allowPointSelect:c,findNearestPointBy:"xy"}],!0===l&&T.series.push({name:"Baseline fitting",type:"line",data:L,allowPointSelect:!1,colorIndex:3}),console.log("series",T.series);if(b){var q=z.map((function(e,t){return[e,0]}));q.forEach((function(e,t){e[1]=b[t]})),T.series.push({name:"Gaussian",type:"line",data:q,findNearestPointBy:"xy",colorIndex:5})}var V="".concat(E.get("CTYPE2"),": ").concat(Y(E.get("CRVAL2")),", ").concat(E.get("CTYPE3"),": ").concat(Y(E.get("CRVAL3")));T.title={text:y},T.subtitle={text:V};var N={title:{text:h}},B={title:{text:E.get("BUNIT")}};T.xAxis=N,T.yAxis=B}!0===c&&T.chart?(T.chart.zoomType="xy",T.chart.renderTo=null===g||void 0===g?void 0:g.container,T.chart.events={selection:x,click:function(){var e=null===g||void 0===g?void 0:g.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)})),n(F([]))}}):T.chart&&(T.chart.zoomType="x",T.chart.events={selection:void 0,click:void 0,render:void 0}),console.log("options",T);return Object(W.jsxs)("div",{children:[Object(W.jsx)(H.a,{highcharts:I.a,options:T,ref:v,containerProps:{onMouseMove:function(e){var t=function(e){var t=0,n=0;if(g){var i=g.pointer.normalize(e),a=i.chartX-g.plotLeft,c=i.chartY-g.plotTop;a>=0&&c>=0&&a<=g.chartWidth&&c<=g.chartHeight&&(t=g.xAxis[0].toValue(a,!0),n=g.yAxis[0].toValue(c,!0))}return{xPos:t,yPos:n}}(e),i=t.xPos,a=t.yPos;n(m([i,a]))}}}),Object(W.jsx)(K,{unit:k,setUnit:w,dataSource:P,unSelectAllPoints:function(){var e=null===g||void 0===g?void 0:g.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)}))}})]})})),K=function(e){var t=Object(p.b)(),n=Object(p.c)((function(e){return e.cursor.drag})),i=Object(p.c)((function(e){return e.baseline.dataPoints})),a=Object(p.c)((function(e){return e.baseline.fitValues})),c=Object(p.c)((function(e){return e.baseline.subtraction})),o=a.length>0,s=i.map((function(e){return e[0]})),r=i.map((function(e){return e[1]})),l=Object(p.c)((function(e){return e.gaussian.order})),u=Object(p.c)((function(e){return e.gaussian.isFitting})),j=Object(p.c)((function(e){return e.gaussian.guess})),b=e.dataSource,f=e.unit,x=e.setUnit,O=e.unSelectAllPoints,h=function(e,n){var i=null===b||void 0===b?void 0:b.fit_baseline(e,n,f).toJs(),a=[].slice.call(i);t(T(a))},v=function(e){var n=null===b||void 0===b?void 0:b.fit_gaussian(f,e,j).toJs(),i=[].slice.call(n);t(G(i))};return Object(W.jsxs)("div",{style:{display:"flex"},children:[Object(W.jsxs)(d.c,{children:[Object(W.jsx)(U.a,{content:"Cursor action: drag to zoom",position:J.a.TOP_LEFT,minimal:!0,children:Object(W.jsx)(d.a,{icon:"zoom-in",small:!0,active:"zoom"===n,onClick:function(){t(y("zoom"))}})}),Object(W.jsx)(U.a,{content:"Cursor action: select baseline points",position:J.a.TOP_LEFT,minimal:!0,children:Object(W.jsx)(d.a,{icon:"widget-button",small:!0,active:"baseline"===n,disabled:c,onClick:function(){t(y("baseline"))}})}),Object(W.jsx)(U.a,{content:"Cursor action: select gaussian peak ranges",position:J.a.TOP_LEFT,minimal:!0,children:Object(W.jsx)(d.a,{icon:"widget",small:!0,active:"gaussian"===n,disabled:!o||!c,onClick:function(){t(y("gaussian"))}})})]}),Object(W.jsx)(d.f,{}),Object(W.jsx)(U.a,{content:"Subtraction baseline",position:J.a.TOP_LEFT,minimal:!0,children:Object(W.jsx)(d.a,{icon:"bring-data",small:!0,active:c,onClick:function(){t(C(!c)),t(y("zoom"))}})}),Object(W.jsx)(U.a,{content:"Fit baseline",position:J.a.TOP_LEFT,minimal:!0,children:Object(W.jsx)(d.a,{icon:"regression-chart",small:!0,disabled:!i.length,onClick:function(){h(s,r)}})}),Object(W.jsx)(U.a,{content:"Remove all baseline data",position:J.a.TOP_LEFT,minimal:!0,children:Object(W.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){O(),t(F([])),h([],[])}})}),Object(W.jsx)(d.f,{}),Object(W.jsx)(U.a,{className:D.a.TOOLTIP_INDICATOR,content:"Fit Gaussian",position:J.a.TOP_LEFT,minimal:!0,children:Object(W.jsx)(d.a,{icon:"timeline-bar-chart",small:!0,active:u,disabled:!i.length||!c,onClick:function(){u?t(G([])):v(l),t(L(!u))}})}),Object(W.jsx)(M.a,{content:Object(W.jsx)(d.q,{style:{width:30},value:l,min:0,onValueChange:function(e){t(z(e)),u&&v(e)}}),children:Object(W.jsx)(U.a,{content:"Number of Gaussian peaks",position:J.a.TOP_LEFT,minimal:!0,children:Object(W.jsx)(d.a,{text:l,small:!0})})}),Object(W.jsx)(U.a,{content:"Remove all gaussian data",position:J.a.TOP_LEFT,minimal:!0,children:Object(W.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){t(L(!1)),t(R([])),t(G([]))}})}),Object(W.jsx)(d.g,{style:{marginLeft:"auto",height:10},label:"x-axis unit:",inline:!0,children:Object(W.jsxs)(d.h,{value:f,minimal:!0,onChange:function(e){x(e.target.value)},children:[Object(W.jsx)("option",{value:"freq",children:"Frequency (Hz)"}),Object(W.jsx)("option",{value:"freq-k",children:"Frequency (kHz)"}),Object(W.jsx)("option",{value:"freq-m",children:"Frequency (MHz)"}),Object(W.jsx)("option",{value:"freq-g",children:"Frequency (GHz)"}),Object(W.jsx)("option",{value:"chan",children:"Channel"}),Object(W.jsx)("option",{value:"vel",children:"Velocity (km/s)"})]})})]})},Q=X,Z=n.p+"static/media/salsasource.74c361a6.py",$=(n(157),function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"});case 2:return t=e.sent,e.next=5,t.loadPackage(["astropy","scipy"]);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),ee=function(){var e=Object(u.a)(l.a.mark((function e(t,n){var i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.runPythonAsync(n);case 2:return i=t.globals.get("salsa"),console.log("globals",i),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var te=function(e){var t=Object(p.c)((function(e){return e.cursor.position}));return Object(W.jsx)("div",{style:{textAlign:"left"},children:Object(W.jsxs)(d.l,{children:["Position: (",Y(t[0]),", ",Y(t[1]),")"]})})},ne=function(e){var t=Object(p.c)((function(e){return e.baseline.dataPoints}));return Object(W.jsx)(d.d,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(W.jsxs)(f.a,{numRows:t.length,enableGhostCells:!0,children:[Object(W.jsx)(x.a,{name:"X coordinate",cellRenderer:function(e){return Object(W.jsx)(b.a,{children:"".concat(t[e]?Y(t[e][0]):0)})}}),Object(W.jsx)(x.a,{name:"Y coordinate",cellRenderer:function(e){return Object(W.jsx)(b.a,{children:"".concat(t[e]?Y(t[e][1]):0)})}})]})})},ie=function(e){var t=Object(p.c)((function(e){return e.gaussian.guess}));return Object(W.jsx)(d.d,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(W.jsxs)(f.a,{numRows:t.length,enableGhostCells:!0,columnWidths:[300,200],children:[Object(W.jsx)(x.a,{name:"X range",cellRenderer:function(e){return Object(W.jsxs)(b.a,{children:["(","".concat(t[e]?Y(t[e][0]):0),","," ".concat(t[e]?Y(t[e][1]):0),")"]})}}),Object(W.jsx)(x.a,{name:"Y range",cellRenderer:function(e){return Object(W.jsxs)(b.a,{children:["(","".concat(t[e]?Y(t[e][2]):0),","," ".concat(t[e]?Y(t[e][3]):0),")"]})}})]})})},ae=function(){Object(p.b)();var e=Object(i.useRef)(null),t=Object(i.useState)(!1),n=Object(s.a)(t,2),a=n[0],c=n[1],o=Object(i.useState)(""),r=Object(s.a)(o,2),b=r[0],f=r[1],x=Object(i.useState)("freq"),O=Object(s.a)(x,2),h=O[0],v=O[1],g=Object(i.useState)(),m=Object(s.a)(g,2),y=m[0],P=m[1];Object(i.useEffect)((function(){function t(){return(t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=7;break}return t.next=3,$();case 3:e.current=t.sent,c(!0),t.next=8;break;case 7:console.log("no duplicate reload to avoid pyodide error");case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}));var k=function(){var t=Object(u.a)(l.a.mark((function t(n){var i,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(Z);case 2:return t.next=4,t.sent.text();case 4:return i=t.sent,t.next=7,ee(e.current,i);case 7:a=t.sent,f(n.name),P(a);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(W.jsxs)("div",{className:"App",children:[Object(W.jsxs)(d.m,{children:[Object(W.jsxs)(d.o,{align:j.a.LEFT,children:[Object(W.jsx)(d.p,{children:"SalsaTS"}),Object(W.jsx)(d.n,{}),Object(W.jsx)(d.b,{disabled:!a,minimal:!0,children:Object(W.jsxs)("label",{htmlFor:"input",children:[Object(W.jsx)("input",{type:"file",id:"input",hidden:!0,onChange:function(e){!function(e){if(e){console.log("processing file:",e);var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){window.jsarray=new Float32Array(t.result),k(e)},t.readAsArrayBuffer(e)}}(e.target.files[0])}}),Object(W.jsx)(d.j,{icon:"document"})," Upload"]})})]}),Object(W.jsx)(d.o,{align:j.a.RIGHT,children:Object(W.jsx)(d.b,{icon:"help",text:"Help",minimal:!0,onClick:function(e){e.preventDefault(),window.open("https://github.com/appolloford/salsa-ts/wiki","_blank","noopener,noreferrer")}})})]}),Object(W.jsx)(Q,{fileName:b,dataSource:y,unit:h,setUnit:v}),Object(W.jsx)("div",{style:{display:"flex"},children:Object(W.jsx)("div",{style:{flex:1},children:Object(W.jsxs)(d.v,{children:[Object(W.jsx)(d.u,{id:"cursorpanel",title:"Cursor Information",panel:Object(W.jsx)(te,{})}),Object(W.jsx)(d.u,{id:"baselinepoints",title:"Selected Baseline Points",panel:Object(W.jsx)(ne,{})}),Object(W.jsx)(d.u,{id:"gaussianranges",title:"Selected Gaussian Ranges",panel:Object(W.jsx)(ie,{})})]})})})]})},ce=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,174)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,c=t.getLCP,o=t.getTTFB;n(e),i(e),a(e),c(e),o(e)}))},oe=Object(h.a)({reducer:{cursor:P,baseline:S,gaussian:_}});o.a.render(Object(W.jsx)(a.a.StrictMode,{children:Object(W.jsx)(p.a,{store:oe,children:Object(W.jsx)(ae,{})})}),document.getElementById("root")),ce()}},[[158,1,2]]]);
//# sourceMappingURL=main.447ff6f7.chunk.js.map