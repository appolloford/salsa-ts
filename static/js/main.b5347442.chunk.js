(this["webpackJsonpsalsa-ts"]=this["webpackJsonpsalsa-ts"]||[]).push([[0],{126:function(e,t,n){},127:function(e,t,n){"use strict";n.r(t);var a=n(0),i=n.n(a),s=n(7),c=n.n(s),o=(n(96),n(8)),r=n(9),l=n.n(r),u=n(16),d=n(130),j=n(15),b=n(12),h=n.n(b),f=n(40),x=n.n(f),p=n(41),O=n.n(p),v=n(1);O()(h.a),n(99)(h.a);var g=Object(a.memo)((function(e){var t,n=Object(a.useRef)(null),i=null===(t=n.current)||void 0===t?void 0:t.chart,s=e.selectMode,c=e.setBaselinePoints,o=e.showSubtraction,r=e.isBaselineFitted,l=e.gaussianData;var u,d=e.setCursorX,j=e.setCursorY,b=e.fileName,f=e.dataSource,p=e.unit;u="freq-k"===p?"kHz":"freq-m"===p?"MHz":"freq-g"===p?"GHz":"chan"===p?"Channel":"vel"===p?"Velocity (km/s)":"Hz";var O={chart:{zoomType:"x"},tooltip:{enabled:!0},plotOptions:{series:{enableMouseTracking:!0,tooltip:{followPointer:!1}}}},g=[];if(f){var y=f.axisdata(1,p).toJs(),m=f.rawdata.toJs()[0][0],S=f.header.toJs(),w=[].slice.call(y);g=w.map((function(e,t){return[e,m[t]]}));var k=w.map((function(e,t){return[e,0]}));if(!0===r){var P=f.baseline.toJs();k.forEach((function(e,t){e[1]=P[t]}))}if(!0===o){var F=g.map((function(e,t){return[e[0],e[1]-k[t][1]]}));O.series=[{name:"Observation - Baseline",type:"scatter",data:F,findNearestPointBy:"xy"}]}else O.series=[{name:"Observation",type:"scatter",lineWidth:2,data:g,allowPointSelect:s,findNearestPointBy:"xy"}],!0===r&&O.series.push({name:"Baseline fitting",type:"line",data:k,allowPointSelect:!1,colorIndex:3}),console.log("series",O.series);if(l){var B=w.map((function(e,t){return[e,0]}));B.forEach((function(e,t){e[1]=l[t]})),O.series.push({name:"Gaussian",type:"line",data:B,findNearestPointBy:"xy"})}var C="".concat(S.get("CTYPE2"),": ").concat(S.get("CRVAL2"),", ").concat(S.get("CTYPE3"),": ").concat(S.get("CRVAL3"));O.title={text:b},O.subtitle={text:C};var M={title:{text:u}},A={title:{text:S.get("BUNIT")}};O.xAxis=M,O.yAxis=A}!0===s&&O.chart?(O.chart.zoomType="xy",O.chart.events={selection:function(e){console.log(e),console.log(i),console.log("chart option",null===i||void 0===i?void 0:i.options),(null===i||void 0===i?void 0:i.series)&&i.series.forEach((function(t){!0===t.options.allowPointSelect&&(null===t||void 0===t||t.points.forEach((function(t){t.x>=e.xAxis[0].min&&t.x<=e.xAxis[0].max&&t.y>=e.yAxis[0].min&&t.y<=e.yAxis[0].max&&t.select(!0,!0)})))}));var t=null===i||void 0===i?void 0:i.getSelectedPoints().map((function(e){return[e.x,e.y]}));return c(t),!1},click:function(){var e=null===i||void 0===i?void 0:i.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)})),c([])}}):O.chart&&(O.chart.zoomType="x",O.chart.events={selection:void 0,click:void 0,render:void 0}),console.log("options",O);return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(x.a,{highcharts:h.a,options:O,ref:n,containerProps:{onMouseMove:function(e){var t=function(e){var t=0,n=0;if(i){var a=i.pointer.normalize(e),s=a.chartX-i.plotLeft,c=a.chartY-i.plotTop;s>=0&&c>=0&&s<=i.chartWidth&&c<=i.chartHeight&&(t=i.xAxis[0].toValue(s,!0),n=i.yAxis[0].toValue(c,!0))}return{xPos:t,yPos:n}}(e),n=t.xPos,a=t.yPos;d(n),j(a)}}})})})),y=function(e){return e.baseline.map((function(e,t){return Object(v.jsxs)("tr",{style:{display:"table"},onClick:function(){console.log("click table")},children:[Object(v.jsx)("td",{style:{width:140},children:t}),Object(v.jsx)("td",{style:{width:140},children:e[0]}),Object(v.jsx)("td",{style:{width:140},children:e[1]})]},e[0])}))},m=function(e){var t=e.unit,n=e.setUnit;return Object(v.jsx)(v.Fragment,{children:Object(v.jsxs)(d.e,{children:["x-axis unit:",Object(v.jsxs)(d.b,{value:t,minimal:!0,onChange:function(e){n(e.target.value)},children:[Object(v.jsx)("option",{value:"freq",children:"Frequency (Hz)"}),Object(v.jsx)("option",{value:"freq-k",children:"Frequency (kHz)"}),Object(v.jsx)("option",{value:"freq-m",children:"Frequency (MHz)"}),Object(v.jsx)("option",{value:"freq-g",children:"Frequency (GHz)"}),Object(v.jsx)("option",{value:"chan",children:"Channel"}),Object(v.jsx)("option",{value:"vel",children:"Velocity (km/s)"})]})]})})},S=function(e){var t=e.selectMode,n=e.setSelectMode,a=e.baselinePoints,i=e.clearBaseline,s=e.getBaselineFit,c=e.showSubtraction,o=e.setShowSubtraction;return Object(v.jsxs)("div",{children:[Object(v.jsx)(d.k,{checked:t,label:"select baseline",onChange:function(){n(!t)}}),Object(v.jsx)(d.k,{checked:c,label:"Show only subtraction",onChange:function(){o(!c)}}),Object(v.jsx)(d.a,{text:"Clear",onClick:function(){i()}}),Object(v.jsxs)(d.c,{striped:!0,interactive:!0,condensed:!0,children:[Object(v.jsx)("thead",{style:{display:"table"},children:Object(v.jsxs)("tr",{children:[Object(v.jsx)("th",{style:{width:140},children:"Selected Points"}),Object(v.jsx)("th",{style:{width:140},children:"X coordinate"}),Object(v.jsx)("th",{style:{width:140},children:"Y coordinate"})]})}),Object(v.jsx)("tbody",{style:{display:"block",overflow:"auto",height:150},children:Object(v.jsx)(y,{baseline:a})})]}),Object(v.jsx)(d.a,{text:"Fit Baseline",onClick:function(){s(a)}})]})},w=function(e){var t=e.nGaussian,n=e.setNGaussian,i=e.getGaussianFit,s=Object(a.useState)(!1),c=Object(o.a)(s,2),r=c[0],l=c[1];return Object(v.jsxs)("div",{children:[Object(v.jsx)(d.k,{checked:r,label:"Fit Gaussian",onChange:function(){l(!r),i(t)}}),Object(v.jsx)(d.j,{value:t,min:1,onValueChange:function(e){n(e),r&&i(e)}})]})},k=function(e){var t=e.unit,n=e.setUnit,i=e.selectMode,s=e.setSelectMode,c=e.baselinePoints,r=e.getBaselineFit,l=e.showSubtraction,u=e.setShowSubtraction,j=Object(a.useState)(1),b=Object(o.a)(j,2),h=b[0],f=b[1],x=e.getGaussianFit,p=e.clearBaseline;return Object(v.jsx)("div",{children:Object(v.jsxs)(d.m,{id:"viewerpanels",vertical:!0,children:[Object(v.jsx)(d.l,{id:"generalpanel",title:"General",panel:Object(v.jsx)(m,{unit:t,setUnit:n})}),Object(v.jsx)(d.l,{id:"baselinepanel",title:"Baseline",panel:Object(v.jsx)(S,{selectMode:i,setSelectMode:s,baselinePoints:c,clearBaseline:p,getBaselineFit:r,showSubtraction:l,setShowSubtraction:u})}),Object(v.jsx)(d.l,{id:"gaussianpanel",title:"Gaussian",panel:Object(v.jsx)(w,{nGaussian:h,setNGaussian:f,getGaussianFit:x})})]})})},P=n.p+"static/media/salsasource.1ec6a3c9.py",F=(n(126),function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"});case 2:return t=e.sent,e.next=5,t.loadPackage(["astropy","scipy"]);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),B=function(){var e=Object(u.a)(l.a.mark((function e(t,n){var a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.runPythonAsync(n);case 2:return a=t.globals.get("salsa"),console.log("globals",a),e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var C=function(){var e=Object(a.useRef)(null),t=Object(a.useState)(!1),n=Object(o.a)(t,2),i=n[0],s=n[1],c=Object(a.useState)(""),r=Object(o.a)(c,2),b=r[0],h=r[1],f=Object(a.useState)("freq"),x=Object(o.a)(f,2),p=x[0],O=x[1],y=Object(a.useState)(!1),m=Object(o.a)(y,2),S=m[0],w=m[1],C=Object(a.useState)([]),M=Object(o.a)(C,2),A=M[0],G=M[1],q=Object(a.useState)(!1),z=Object(o.a)(q,2),T=z[0],E=z[1],H=Object(a.useState)(!1),N=Object(o.a)(H,2),J=N[0],L=N[1],U=Object(a.useState)([]),V=Object(o.a)(U,2),Y=V[0],R=V[1],X=Object(a.useState)(0),I=Object(o.a)(X,2),D=I[0],_=I[1],W=Object(a.useState)(0),K=Object(o.a)(W,2),Q=K[0],Z=K[1];Object(a.useEffect)((function(){function t(){return(t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=7;break}return t.next=3,F();case 3:e.current=t.sent,s(!0),t.next=8;break;case 7:console.log("no duplicate reload to avoid pyodide error");case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}));var $=Object(a.useState)(),ee=Object(o.a)($,2),te=ee[0],ne=ee[1],ae=function(){var t=Object(u.a)(l.a.mark((function t(n){var a,i;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(P);case 2:return t.next=4,t.sent.text();case 4:return a=t.sent,t.next=7,B(e.current,a);case 7:i=t.sent,h(n.name),ne(i);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(v.jsxs)("div",{className:"App",children:[Object(v.jsx)(d.f,{children:Object(v.jsxs)(d.h,{align:j.a.LEFT,children:[Object(v.jsx)(d.i,{children:"SalsaTS"}),Object(v.jsx)(d.g,{}),Object(v.jsx)(d.a,{disabled:!i,children:Object(v.jsxs)("label",{htmlFor:"input",children:[Object(v.jsx)("input",{type:"file",id:"input",hidden:!0,onChange:function(e){!function(e){if(e){console.log("processing file:",e);var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){window.jsarray=new Float32Array(t.result),ae(e)},t.readAsArrayBuffer(e)}}(e.target.files[0])}}),Object(v.jsx)(d.d,{icon:"document"})," Upload"]})})]})}),Object(v.jsx)(g,{fileName:b,dataSource:te,unit:p,selectMode:S,baselinePoints:A,isBaselineFitted:T,setBaselinePoints:G,showSubtraction:J,gaussianData:Y,setCursorX:_,setCursorY:Z}),Object(v.jsxs)("h4",{children:["X: ",D," Y: ",Q]}),Object(v.jsx)(k,{unit:p,setUnit:O,selectMode:S,setSelectMode:w,baselinePoints:A,clearBaseline:function(){G([]),null===te||void 0===te||te.fit_baseline([],[],p),E(!1)},getBaselineFit:function(e){var t=e.map((function(e){return e[0]})),n=e.map((function(e){return e[1]}));t.length&&n.length?(null===te||void 0===te||te.fit_baseline(t,n,p),E(!0)):(te.baseline=[],E(!1))},showSubtraction:J,setShowSubtraction:L,getGaussianFit:function(e){var t=null===te||void 0===te?void 0:te.fit_gaussian(p,e).toJs();R(t)}})]})},M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,131)).then((function(t){var n=t.getCLS,a=t.getFID,i=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),a(e),i(e),s(e),c(e)}))};c.a.render(Object(v.jsx)(i.a.StrictMode,{children:Object(v.jsx)(C,{})}),document.getElementById("root")),M()},96:function(e,t,n){}},[[127,1,2]]]);
//# sourceMappingURL=main.b5347442.chunk.js.map