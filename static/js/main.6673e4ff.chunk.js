(this["webpackJsonpsalsa-ts"]=this["webpackJsonpsalsa-ts"]||[]).push([[0],{132:function(e,t,n){},157:function(e,t,n){},158:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),s=n(13),c=n.n(s),o=(n(132),n(21)),r=n(23),l=n.n(r),u=n(41),d=n(159),j=n(36),b=n(40),f=n(173),x=n(79),O=n(80),h=n(17),p=n(32),v=Object(p.b)({name:"cursor",initialState:{position:[0,0],drag:"zoom"},reducers:{setPosition:function(e,t){e.position=t.payload},setDrag:function(e,t){e.drag=t.payload}}}),m=v.actions,g=m.setPosition,y=m.setDrag,P=v.reducer,F=Object(p.b)({name:"baseline",initialState:{dataPoints:[],fitValues:[],subtraction:!1},reducers:{setDataPoints:function(e,t){e.dataPoints=t.payload},setFitValues:function(e,t){e.fitValues=t.payload},setSubtraction:function(e,t){e.subtraction=t.payload}}}),k=F.actions,w=k.setDataPoints,T=k.setFitValues,S=k.setSubtraction,C=F.reducer,A=n(28),G=n.n(A),E=n(74),R=n.n(E),z=n(75),L=n.n(z),q=n(15),V=n(2),_=n(81),I=n(52),B=n(6);L()(G.a),n(140)(G.a);var D=Object(i.memo)((function(e){var t,n,a,s=Object(h.b)(),c=Object(h.c)((function(e){return e.cursor.drag})),r="baseline"===c||"gaussian"===c,l=Object(h.c)((function(e){return e.baseline.fitValues})),u=Object(h.c)((function(e){return e.baseline.subtraction})),d=l.length>0,j=Object(i.useRef)(null),b=null===(t=j.current)||void 0===t?void 0:t.chart,f=e.gaussianGuess,x=e.setGaussianGuess,p=e.gaussianGuessRef,v=e.gaussianData,m=e.getGaussianFit,y=e.fileName,P=e.dataSource,F=e.unit,k=e.setUnit;"baseline"===c?n=function(e){console.log(e),console.log(b),console.log("chart option",null===b||void 0===b?void 0:b.options),(null===b||void 0===b?void 0:b.series)&&b.series.forEach((function(t){!0===t.options.allowPointSelect&&(null===t||void 0===t||t.points.forEach((function(t){t.x>=e.xAxis[0].min&&t.x<=e.xAxis[0].max&&t.y>=e.yAxis[0].min&&t.y<=e.yAxis[0].max&&t.select(!0,!0)})))}));var t=(null===b||void 0===b?void 0:b.getSelectedPoints().map((function(e){return[e.x||0,e.y||0]})))||[];return s(w(t)),!1}:"gaussian"===c&&(n=function(e){var t=[e.xAxis[0].min,e.xAxis[0].max,e.yAxis[0].min,e.yAxis[0].max];return x([].concat(Object(O.a)(f),[t])),function(e){var t=Object(o.a)(e,4),n=t[0],i=t[1],a=t[2],s=t[3],c=(null===b||void 0===b?void 0:b.xAxis[0].toPixels(n,!1))||0,r=(null===b||void 0===b?void 0:b.xAxis[0].toPixels(i,!1))||0,l=(null===b||void 0===b?void 0:b.yAxis[0].toPixels(a,!1))||0,u=(null===b||void 0===b?void 0:b.yAxis[0].toPixels(s,!1))||0,d=r-c,j=l-u;console.log("rect params",c,u,d,j);var f=null===b||void 0===b?void 0:b.renderer.rect(c,u,d,j,2).attr({"stroke-width":2,stroke:"red",fill:"black","fill-opacity":.1,zIndex:3}).on("click",(function(){x(p.current.filter((function(t){return t!==e}))),null===f||void 0===f||f.destroy()})).add()}(t),!1}),a="freq-k"===F?"kHz":"freq-m"===F?"MHz":"freq-g"===F?"GHz":"chan"===F?"Channel":"vel"===F?"Velocity (km/s)":"Hz";var T={chart:{zoomType:"x"},tooltip:{enabled:!0},plotOptions:{series:{enableMouseTracking:!0,tooltip:{followPointer:!1}}}},S=[];if(P){var C=P.axisdata(1,F).toJs(),A=P.rawdata.toJs()[0][0],E=P.header.toJs(),z=[].slice.call(C);S=z.map((function(e,t){return[e,A[t]]}));var L=z.map((function(e,t){return[e,0]}));if(!0===d&&L.forEach((function(e,t){e[1]=l[t]})),!0===u){var q=S.map((function(e,t){return[e[0],e[1]-L[t][1]]}));T.series=[{name:"Observation - Baseline",type:"scatter",data:q,findNearestPointBy:"xy"}]}else T.series=[{name:"Observation",type:"scatter",lineWidth:2,data:S,allowPointSelect:r,findNearestPointBy:"xy"}],!0===d&&T.series.push({name:"Baseline fitting",type:"line",data:L,allowPointSelect:!1,colorIndex:3}),console.log("series",T.series);if(v){var V=z.map((function(e,t){return[e,0]}));V.forEach((function(e,t){e[1]=v[t]})),T.series.push({name:"Gaussian",type:"line",data:V,findNearestPointBy:"xy",colorIndex:5})}var _="".concat(E.get("CTYPE2"),": ").concat(E.get("CRVAL2").toFixed(6),", ").concat(E.get("CTYPE3"),": ").concat(E.get("CRVAL3").toFixed(6));T.title={text:y},T.subtitle={text:_};var I={title:{text:a}},D={title:{text:E.get("BUNIT")}};T.xAxis=I,T.yAxis=D}!0===r&&T.chart?(T.chart.zoomType="xy",T.chart.renderTo=null===b||void 0===b?void 0:b.container,T.chart.events={selection:n,click:function(){var e=null===b||void 0===b?void 0:b.getSelectedPoints();(null===e||void 0===e?void 0:e.length)&&e.length>0&&e.forEach((function(e){e.select(!1)})),s(w([]))}}):T.chart&&(T.chart.zoomType="x",T.chart.events={selection:void 0,click:void 0,render:void 0}),console.log("options",T);return Object(B.jsxs)("div",{children:[Object(B.jsx)(R.a,{highcharts:G.a,options:T,ref:j,containerProps:{onMouseMove:function(e){var t=function(e){var t=0,n=0;if(b){var i=b.pointer.normalize(e),a=i.chartX-b.plotLeft,s=i.chartY-b.plotTop;a>=0&&s>=0&&a<=b.chartWidth&&s<=b.chartHeight&&(t=b.xAxis[0].toValue(a,!0),n=b.yAxis[0].toValue(s,!0))}return{xPos:t,yPos:n}}(e),n=t.xPos,i=t.yPos;s(g([n,i]))}}}),Object(B.jsx)(H,{unit:F,setUnit:k,dataSource:P,getGaussianFit:m,setGaussianGuess:x,unSelectAllPoints:function(){null===b||void 0===b||b.series.forEach((function(e){null===e||void 0===e||e.points.forEach((function(e){e.selected=!1}))}))}})]})})),H=function(e){var t=Object(h.b)(),n=Object(h.c)((function(e){return e.cursor.drag})),a=Object(h.c)((function(e){return e.baseline.dataPoints})),s=Object(h.c)((function(e){return e.baseline.fitValues})),c=Object(h.c)((function(e){return e.baseline.subtraction})),r=s.length>0,l=a.map((function(e){return e[0]})),u=a.map((function(e){return e[1]})),j=e.dataSource,b=e.getGaussianFit,f=e.unit,x=e.setUnit,O=Object(i.useState)(0),p=Object(o.a)(O,2),v=p[0],m=p[1],g=Object(i.useState)(!1),P=Object(o.a)(g,2),F=P[0],k=P[1],C=e.setGaussianGuess,A=e.unSelectAllPoints,G=function(e,n){var i=null===j||void 0===j?void 0:j.fit_baseline(e,n,f).toJs(),a=[].slice.call(i);t(T(a))};return Object(B.jsxs)("div",{style:{display:"flex"},children:[Object(B.jsxs)(d.c,{children:[Object(B.jsx)(_.a,{content:"Cursor action: drag to zoom",position:q.a.TOP_LEFT,minimal:!0,children:Object(B.jsx)(d.a,{icon:"zoom-in",small:!0,active:"zoom"===n,onClick:function(){t(y("zoom"))}})}),Object(B.jsx)(_.a,{content:"Cursor action: select baseline points",position:q.a.TOP_LEFT,minimal:!0,children:Object(B.jsx)(d.a,{icon:"widget-button",small:!0,active:"baseline"===n,disabled:c,onClick:function(){t(y("baseline"))}})}),Object(B.jsx)(_.a,{content:"Cursor action: select gaussian peak ranges",position:q.a.TOP_LEFT,minimal:!0,children:Object(B.jsx)(d.a,{icon:"widget",small:!0,active:"gaussian"===n,disabled:!r||!c,onClick:function(){t(y("gaussian"))}})})]}),Object(B.jsx)(d.f,{}),Object(B.jsx)(_.a,{content:"Subtraction baseline",position:q.a.TOP_LEFT,minimal:!0,children:Object(B.jsx)(d.a,{icon:"bring-data",small:!0,active:c,onClick:function(){t(S(!c)),t(y("zoom"))}})}),Object(B.jsx)(_.a,{content:"Fit baseline",position:q.a.TOP_LEFT,minimal:!0,children:Object(B.jsx)(d.a,{icon:"regression-chart",small:!0,disabled:!a.length,onClick:function(){G(l,u)}})}),Object(B.jsx)(_.a,{content:"Remove all baseline data",position:q.a.TOP_LEFT,minimal:!0,children:Object(B.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){A(),t(w([])),G([],[])}})}),Object(B.jsx)(d.f,{}),Object(B.jsx)(_.a,{className:V.a.TOOLTIP_INDICATOR,content:"Fit Gaussian",position:q.a.TOP_LEFT,minimal:!0,children:Object(B.jsx)(d.a,{icon:"timeline-bar-chart",small:!0,active:F,onClick:function(){b(F?0:v),k(!F)}})}),Object(B.jsx)(I.a,{content:Object(B.jsx)(d.q,{style:{width:30},value:v,min:0,onValueChange:function(e){m(e),F&&b(e)}}),children:Object(B.jsx)(_.a,{content:"Number of Gaussian peaks",position:q.a.TOP_LEFT,minimal:!0,children:Object(B.jsx)(d.a,{text:v,small:!0})})}),Object(B.jsx)(_.a,{content:"Remove all gaussian data",position:q.a.TOP_LEFT,minimal:!0,children:Object(B.jsx)(d.a,{icon:"delete",small:!0,onClick:function(){C([]),b(0)}})}),Object(B.jsx)(d.g,{style:{marginLeft:"auto",height:10},label:"x-axis unit:",inline:!0,children:Object(B.jsxs)(d.h,{value:f,minimal:!0,onChange:function(e){x(e.target.value)},children:[Object(B.jsx)("option",{value:"freq",children:"Frequency (Hz)"}),Object(B.jsx)("option",{value:"freq-k",children:"Frequency (kHz)"}),Object(B.jsx)("option",{value:"freq-m",children:"Frequency (MHz)"}),Object(B.jsx)("option",{value:"freq-g",children:"Frequency (GHz)"}),Object(B.jsx)("option",{value:"chan",children:"Channel"}),Object(B.jsx)("option",{value:"vel",children:"Velocity (km/s)"})]})})]})},N=D,J=n.p+"static/media/salsasource.74c361a6.py",U=(n(157),function(){var e=Object(u.a)(l.a.mark((function e(){var t;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.loadPyodide({indexURL:"https://cdn.jsdelivr.net/pyodide/v0.18.1/full/"});case 2:return t=e.sent,e.next=5,t.loadPackage(["astropy","scipy"]);case 5:return e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),M=function(){var e=Object(u.a)(l.a.mark((function e(t,n){var i;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.runPythonAsync(n);case 2:return i=t.globals.get("salsa"),console.log("globals",i),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();var Y=function(e){var t=Object(h.c)((function(e){return e.cursor.position}));return Object(B.jsx)("div",{style:{textAlign:"left"},children:Object(B.jsxs)(d.l,{children:["Position: (",t[0].toFixed(6),", ",t[1].toFixed(6),")"]})})},W=function(e){var t=Object(h.c)((function(e){return e.baseline.dataPoints}));return Object(B.jsx)(d.d,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(B.jsxs)(f.a,{numRows:t.length,enableGhostCells:!0,children:[Object(B.jsx)(x.a,{name:"X coordinate",cellRenderer:function(e){return Object(B.jsx)(b.a,{children:"".concat(t[e]?t[e][0].toFixed(6):0)})}}),Object(B.jsx)(x.a,{name:"Y coordinate",cellRenderer:function(e){return Object(B.jsx)(b.a,{children:"".concat(t[e]?t[e][1].toFixed(6):0)})}})]})})},X=function(e){var t=e.gaussianGuess;return Object(B.jsx)(d.d,{style:{display:"block",overflow:"auto",width:600,height:150},children:Object(B.jsxs)(f.a,{numRows:t.length,enableGhostCells:!0,columnWidths:[300,200],children:[Object(B.jsx)(x.a,{name:"X range",cellRenderer:function(e){return Object(B.jsxs)(b.a,{children:["(","".concat(t[e]?t[e][0].toFixed(6):0),",","".concat(t[e]?t[e][1].toFixed(6):0),")"]})}}),Object(B.jsx)(x.a,{name:"Y range",cellRenderer:function(e){return Object(B.jsxs)(b.a,{children:["(","".concat(t[e]?t[e][2].toFixed(6):0),",","".concat(t[e]?t[e][3].toFixed(6):0),")"]})}})]})})},K=function(){Object(h.b)();var e=Object(i.useRef)(null),t=Object(i.useState)(!1),n=Object(o.a)(t,2),a=n[0],s=n[1],c=Object(i.useState)(""),r=Object(o.a)(c,2),b=r[0],f=r[1],x=Object(i.useState)("freq"),O=Object(o.a)(x,2),p=O[0],v=O[1],m=function(e){var t=Object(i.useState)(e),n=Object(o.a)(t,2),a=n[0],s=n[1],c=Object(i.useRef)(a);return Object(i.useEffect)((function(){c.current=a}),[a]),[a,s,c]}([]),g=Object(o.a)(m,3),y=g[0],P=g[1],F=g[2],k=Object(i.useState)([]),w=Object(o.a)(k,2),T=w[0],S=w[1];Object(i.useEffect)((function(){function t(){return(t=Object(u.a)(l.a.mark((function t(){return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=7;break}return t.next=3,U();case 3:e.current=t.sent,s(!0),t.next=8;break;case 7:console.log("no duplicate reload to avoid pyodide error");case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}));var C=Object(i.useState)(),A=Object(o.a)(C,2),G=A[0],E=A[1],R=function(){var t=Object(u.a)(l.a.mark((function t(n){var i,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch(J);case 2:return t.next=4,t.sent.text();case 4:return i=t.sent,t.next=7,M(e.current,i);case 7:a=t.sent,f(n.name),E(a);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(B.jsxs)("div",{className:"App",children:[Object(B.jsxs)(d.m,{children:[Object(B.jsxs)(d.o,{align:j.a.LEFT,children:[Object(B.jsx)(d.p,{children:"SalsaTS"}),Object(B.jsx)(d.n,{}),Object(B.jsx)(d.b,{disabled:!a,minimal:!0,children:Object(B.jsxs)("label",{htmlFor:"input",children:[Object(B.jsx)("input",{type:"file",id:"input",hidden:!0,onChange:function(e){!function(e){if(e){console.log("processing file:",e);var t=new FileReader;t.onabort=function(){return console.log("file reading was aborted")},t.onerror=function(){return console.log("file reading has failed")},t.onload=function(){window.jsarray=new Float32Array(t.result),R(e)},t.readAsArrayBuffer(e)}}(e.target.files[0])}}),Object(B.jsx)(d.j,{icon:"document"})," Upload"]})})]}),Object(B.jsx)(d.o,{align:j.a.RIGHT,children:Object(B.jsx)(d.b,{icon:"link",text:"Document",minimal:!0,onClick:function(e){e.preventDefault(),window.open("https://github.com/appolloford/salsa-ts/wiki","_blank","noopener,noreferrer")}})})]}),Object(B.jsx)(N,{fileName:b,dataSource:G,unit:p,setUnit:v,gaussianGuess:y,setGaussianGuess:P,gaussianGuessRef:F,gaussianData:T,getGaussianFit:function(e){var t=null===G||void 0===G?void 0:G.fit_gaussian(p,e,y).toJs();S(t)}}),Object(B.jsx)("div",{style:{display:"flex"},children:Object(B.jsx)("div",{style:{flex:1},children:Object(B.jsxs)(d.v,{children:[Object(B.jsx)(d.u,{id:"cursorpanel",title:"Cursor Information",panel:Object(B.jsx)(Y,{})}),Object(B.jsx)(d.u,{id:"baselinepoints",title:"Selected Baseline Points",panel:Object(B.jsx)(W,{})}),Object(B.jsx)(d.u,{id:"gaussianranges",title:"Selected Gaussian Ranges",panel:Object(B.jsx)(X,{gaussianGuess:y})})]})})})]})},Q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,174)).then((function(t){var n=t.getCLS,i=t.getFID,a=t.getFCP,s=t.getLCP,c=t.getTTFB;n(e),i(e),a(e),s(e),c(e)}))},Z=Object(p.a)({reducer:{cursor:P,baseline:C}});c.a.render(Object(B.jsx)(a.a.StrictMode,{children:Object(B.jsx)(h.a,{store:Z,children:Object(B.jsx)(K,{})})}),document.getElementById("root")),Q()}},[[158,1,2]]]);
//# sourceMappingURL=main.6673e4ff.chunk.js.map